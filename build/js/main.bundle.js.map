{"version":3,"sources":["webpack://threejs-es6-webpack-boilerplate/./src/js/data/config.js","webpack://threejs-es6-webpack-boilerplate/./src/js/utils/detector.js","webpack://threejs-es6-webpack-boilerplate/./src/js/app/helpers/vertexNormalsHelper.js","webpack://threejs-es6-webpack-boilerplate/./src/js/app/loaders/GLTFLoader.js","webpack://threejs-es6-webpack-boilerplate/./src/js/app/game/scene.js","webpack://threejs-es6-webpack-boilerplate/./src/js/webrtc/peerConnection.js","webpack://threejs-es6-webpack-boilerplate/./src/js/app/game/gameController.js","webpack://threejs-es6-webpack-boilerplate/./src/js/app/game.js","webpack://threejs-es6-webpack-boilerplate/./src/js/webrtc/videoCall.js","webpack://threejs-es6-webpack-boilerplate/./src/js/app.js","webpack://threejs-es6-webpack-boilerplate/./src/js/utils/orbitControls.js"],"names":["TWEEN","Math","PI","canvas","window","CanvasRenderingContext2D","webgl","document","createElement","WebGLRenderingContext","getContext","e","workers","Worker","fileapi","File","FileReader","FileList","Blob","getWebGLErrorMessage","element","id","style","fontFamily","fontSize","fontWeight","textAlign","background","color","padding","width","margin","this","innerHTML","join","addGetWebGLMessage","parameters","parent","undefined","body","appendChild","_v1","Vector3","_v2","_normalMatrix","Matrix3","_keys","VertexNormalsHelper","object","size","hex","nNormals","objGeometry","geometry","isGeometry","faces","length","isBufferGeometry","attributes","normal","count","BufferGeometry","positions","Float32BufferAttribute","setAttribute","LineSegments","LineBasicMaterial","toneMapped","type","matrixAutoUpdate","update","prototype","Object","create","constructor","idx","updateMatrixWorld","getNormalMatrix","matrixWorld","position","vertices","i","l","face","j","jl","vertexNormals","vertex","copy","applyMatrix4","applyMatrix3","normalize","multiplyScalar","add","setXYZ","x","y","z","objPos","objNorm","set","getX","getY","getZ","needsUpdate","GLTFLoader","manager","Loader","dracoLoader","ddsLoader","GLTFRegistry","objects","get","key","remove","removeAll","assign","load","url","onLoad","onProgress","onError","resourcePath","scope","path","LoaderUtils","itemStart","_onError","console","error","itemError","itemEnd","loader","FileLoader","setPath","setResponseType","crossOrigin","setWithCredentials","data","parse","gltf","setDRACOLoader","setDDSLoader","content","extensions","Uint8Array","BINARY_EXTENSION_HEADER_MAGIC","EXTENSIONS","KHR_BINARY_GLTF","GLTFBinaryExtension","json","JSON","asset","version","Error","extensionsUsed","extensionName","extensionsRequired","KHR_LIGHTS_PUNCTUAL","GLTFLightsExtension","KHR_MATERIALS_CLEARCOAT","GLTFMaterialsClearcoatExtension","KHR_MATERIALS_UNLIT","GLTFMaterialsUnlitExtension","KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS","GLTFMaterialsPbrSpecularGlossinessExtension","KHR_DRACO_MESH_COMPRESSION","GLTFDracoMeshCompressionExtension","MSFT_TEXTURE_DDS","GLTFTextureDDSExtension","KHR_TEXTURE_TRANSFORM","GLTFTextureTransformExtension","KHR_MESH_QUANTIZATION","GLTFMeshQuantizationExtension","indexOf","warn","GLTFParser","name","extension","lightDefs","lights","loadLight","lightIndex","lightNode","lightDef","Color","fromArray","range","DirectionalLight","target","PointLight","distance","SpotLight","spot","innerConeAngle","outerConeAngle","angle","penumbra","decay","intensity","Promise","resolve","getMaterialType","MeshBasicMaterial","extendParams","materialParams","materialDef","parser","pending","opacity","metallicRoughness","pbrMetallicRoughness","Array","isArray","baseColorFactor","array","baseColorTexture","push","assignTexture","all","MeshPhysicalMaterial","clearcoatFactor","clearcoat","clearcoatTexture","clearcoatRoughnessFactor","clearcoatRoughness","clearcoatRoughnessTexture","clearcoatNormalTexture","scale","clearcoatNormalScale","Vector2","BINARY_EXTENSION_CHUNK_TYPES","headerView","DataView","header","magic","slice","getUint32","chunkView","chunkIndex","byteLength","chunkLength","chunkType","contentArray","byteOffset","preload","GLTFMeshStandardSGMaterial","params","MeshStandardMaterial","isGLTFSpecularGlossinessMaterial","specularMapParsFragmentChunk","glossinessMapParsFragmentChunk","specularMapFragmentChunk","glossinessMapFragmentChunk","lightPhysicalFragmentChunk","uniforms","specular","value","setHex","glossiness","specularMap","glossinessMap","_extraUniforms","onBeforeCompile","shader","uniformName","fragmentShader","replace","defineProperties","v","defines","USE_GLOSSINESSMAP","USE_ROUGHNESSMAP","metalness","roughness","metalnessMap","roughnessMap","setValues","specularGlossinessParams","pbrSpecularGlossiness","diffuseFactor","diffuseTexture","emissive","glossinessFactor","specularFactor","specularGlossinessTexture","specGlossMapDef","createMaterial","material","fog","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","TangentSpaceNormalMap","normalScale","displacementMap","displacementScale","displacementBias","alphaMap","envMap","envMapIntensity","refractionRatio","GLTFCubicSplineInterpolant","parameterPositions","sampleValues","sampleSize","resultBuffer","Interpolant","decodePrimitive","primitive","bufferViewIndex","bufferView","gltfAttributeMap","threeAttributeMap","attributeNormalizedMap","attributeTypeMap","attributeName","threeAttributeName","ATTRIBUTES","toLowerCase","accessorDef","accessors","componentType","WEBGL_COMPONENT_TYPES","normalized","getDependency","then","decodeDracoFile","attribute","extendTexture","texture","transform","clone","offset","rotation","repeat","texCoord","source","copySampleValue_","index","result","values","valueSize","beforeStart_","afterEnd_","interpolate_","i1","t0","t","t1","stride","stride2","stride3","td","p","pp","ppp","offset1","offset0","s2","s3","s0","s1","p0","m0","p1","m1","WEBGL_CONSTANTS","5120","Int8Array","5121","5122","Int16Array","5123","Uint16Array","5125","Uint32Array","5126","Float32Array","WEBGL_FILTERS","9728","NearestFilter","9729","LinearFilter","9984","NearestMipmapNearestFilter","9985","LinearMipmapNearestFilter","9986","NearestMipmapLinearFilter","9987","LinearMipmapLinearFilter","WEBGL_WRAPPINGS","33071","ClampToEdgeWrapping","33648","MirroredRepeatWrapping","10497","RepeatWrapping","WEBGL_TYPE_SIZES","SCALAR","VEC2","VEC3","VEC4","MAT2","MAT3","MAT4","POSITION","NORMAL","TANGENT","TEXCOORD_0","TEXCOORD_1","COLOR_0","WEIGHTS_0","JOINTS_0","PATH_PROPERTIES","translation","weights","INTERPOLATION","CUBICSPLINE","LINEAR","InterpolateLinear","STEP","InterpolateDiscrete","ALPHA_MODES","MIME_TYPE_FORMATS","RGBAFormat","RGBFormat","resolveURL","test","addUnknownExtensionsToUserData","knownExtensions","objectDef","userData","gltfExtensions","assignExtrasToUserData","gltfDef","extras","updateMorphTargets","mesh","meshDef","il","morphTargetInfluences","targetNames","morphTargetDictionary","createAttributesKey","attributesKey","keys","sort","options","cache","primitiveCache","textureLoader","TextureLoader","setCrossOrigin","fileLoader","addPrimitiveAttributes","primitiveDef","assignAttributeAccessor","accessorIndex","accessor","gltfAttributeName","indices","setIndex","box","Box3","min","max","targets","maxDisplacement","vector","setX","abs","setY","setZ","expandByVector","boundingBox","sphere","Sphere","getCenter","center","radius","distanceTo","boundingSphere","computeBounds","hasMorphPosition","hasMorphNormal","pendingPositionAccessors","pendingNormalAccessors","pendingAccessor","morphPositions","morphNormals","morphAttributes","morphTargetsRelative","addMorphTargets","toTrianglesDrawMode","drawMode","getIndex","getAttribute","numberOfTriangles","newIndices","TriangleFanDrawMode","newGeometry","markDefs","getDependencies","dependencies","scene","scenes","animations","cameras","nodeDefs","nodes","skinDefs","skins","meshDefs","meshes","meshReferences","meshUses","skinIndex","skinLength","joints","isBone","nodeIndex","nodeLength","nodeDef","skin","isSkinnedMesh","cacheKey","dependency","loadScene","loadNode","loadMesh","loadAccessor","loadBufferView","loadBuffer","loadMaterial","loadTexture","loadSkin","loadAnimation","loadCamera","defs","def","bufferIndex","bufferDef","buffers","uri","reject","bufferViewDef","bufferViews","buffer","sparse","pendingBufferViews","bufferAttribute","itemSize","TypedArray","elementBytes","BYTES_PER_ELEMENT","itemBytes","byteStride","ibSlice","floor","ibCacheKey","ib","InterleavedBuffer","InterleavedBufferAttribute","BufferAttribute","itemSizeIndices","TypedArrayIndices","byteOffsetIndices","byteOffsetValues","sparseIndices","sparseValues","setW","textureIndex","URL","self","webkitURL","textureDef","textures","textureExtensions","sourceURI","images","isObjectURL","blob","mimeType","createObjectURL","getHandler","revokeObjectURL","flipY","format","sampler","samplers","magFilter","minFilter","wrapS","wrapT","mapName","mapDef","isCompressedTexture","assignFinalMaterial","useVertexTangents","tangent","useVertexColors","useFlatShading","useSkinning","useMorphTargets","useMorphNormals","isPoints","uuid","pointsMaterial","PointsMaterial","Material","sizeAttenuation","isLine","lineMaterial","cachedMaterial","skinning","vertexTangents","vertexColors","flatShading","morphTargets","uv2","uv","materialIndex","materialType","materials","materialExtensions","sgExtension","kmuExtension","metallicFactor","roughnessFactor","metallicRoughnessTexture","doubleSided","side","DoubleSide","alphaMode","transparent","depthWrite","alphaTest","alphaCutoff","normalTexture","occlusionTexture","strength","emissiveFactor","emissiveTexture","clearcoatExtension","encoding","sRGBEncoding","loadGeometries","primitives","createDracoPrimitive","dracoExtension","geometryPromise","mode","cached","promise","meshIndex","depthTest","FrontSide","results","geometries","SkinnedMesh","Mesh","skinWeight","normalizeSkinWeights","TriangleStripDrawMode","Line","LineLoop","Points","group","Group","cameraIndex","camera","cameraDef","PerspectiveCamera","MathUtils","yfov","aspectRatio","znear","zfar","OrthographicCamera","xmag","ymag","skinDef","skinEntry","inverseBindMatrices","animationIndex","animationDef","pendingNodes","pendingInputAccessors","pendingOutputAccessors","pendingSamplers","pendingTargets","channels","channel","node","input","output","inputAccessors","outputAccessors","tracks","inputAccessor","outputAccessor","TypedKeyframeTrack","updateMatrix","NumberKeyframeTrack","QuaternionKeyframeTrack","VectorKeyframeTrack","targetName","interpolation","traverse","isMesh","outputArray","scaled","track","createInterpolant","times","getValueSize","isInterpolantFactoryMethodGLTFCubicSpline","AnimationClip","instanceNum","o","light","Bone","Object3D","PropertyBinding","matrix","Matrix4","quaternion","buildNodeHierachy","nodeId","parentObject","pendingJoints","jointNodes","bones","boneInverses","jointNode","mat","bind","Skeleton","children","child","sceneIndex","sceneDef","nodeIds","PeerConnection","peerConnectionConfig","rtcPeerConnection","dataChannels","location","hostname","RTCPeerConnection","log","message","alert","channelName","dataChannel","createDataChannel","ordered","room","localObjects","initScene","THREE","directionalLight1","directionalLight2","directionalLight3","initLight","localScene","localCamera","duckMesh","isInitiator","gameController","addLocalObject","obj","stringify","customObject","startSharedSceneSync","stopSharedSceneSync","clearInterval","sharedSceneSync","sendGameobjectUpdate","objectJson","readyState","updateRemoteObjects","localElement","getLocalObject","cube","_x","_y","_z","objectsToSync","Map","renderer","alpha","draggableObjectsSeller","isSeller","startGame","setPixelRatio","devicePixelRatio","setSize","innerWidth","innerHeight","autoClear","getElementById","domElement","lookAt","initCamera","init3DObjects","DragControls","addEventListener","event","getObjJSON","render","animate","loadAsync","duckMesh1","addObjectToDragConrols","duckMesh2","duckMesh3","outputEncoding","plane","moveRemoteVideoToScene","setTimeout","remoteVideo","reomoteVideoAspectRatio","offsetWidth","offsetHeight","videoElement","videoTexture","videoGeometry","videoMaterial","overdraw","cube2","requestAnimationFrame","localStream","remoteStream","peerConnection","isChannelReady","isStarted","roomName","prompt","socket","io","connect","sendSignalingMessage","emit","on","apply","maybeStart","setRemoteDescription","createAnswer","setLocalAndSendMessage","onCreateSessionDescriptionError","RTCSessionDescription","candidate","RTCIceCandidate","sdpMLineIndex","label","addIceCandidate","stop","localVideo","querySelector","navigator","mediaDevices","getUserMedia","video","audio","stream","srcObject","initPeerConnection","getTracks","addTrack","onmessage","handleReceiveMessage","onerror","handleDataChannelError","onopen","handleDataChannelStatusChange","onclose","createOffer","handleCreateOfferError","onpagehide","eventName","userAgent","match","maxTouchPoints","onicecandidate","handleIceCandidate","ontrack","handleTrackAdded","ondatachannel","handleDataChannelAdded","sdpMid","streams","MediaStream","autoplay","sessionDescription","setLocalDescription","toString","close","pause","removeAttribute","has","getObjectByName","newObj","Detector","initGame","module","exports","MOUSE","OrbitConstraint","minDistance","maxDistance","Infinity","minZoom","maxZoom","minPolarAngle","maxPolarAngle","minAzimuthAngle","maxAzimuthAngle","enableDamping","dampingFactor","theta","phi","quat","quatInverse","lastPosition","lastQuaternion","EPS","phiDelta","thetaDelta","panOffset","zoomChanged","getPolarAngle","getAzimuthalAngle","rotateLeft","rotateUp","panLeft","te","elements","panUp","pan","deltaX","deltaY","screenWidth","screenHeight","targetDistance","sub","tan","fov","right","left","top","bottom","dollyIn","dollyScale","zoom","updateProjectionMatrix","dollyOut","Quaternion","setFromUnitVectors","up","inverse","applyQuaternion","atan2","sqrt","sin","cos","distanceToSquared","dot","OrbitControls","constraint","defineProperty","enabled","enableZoom","zoomSpeed","enableRotate","rotateSpeed","enablePan","keyPanSpeed","autoRotate","autoRotateSpeed","enableKeys","LEFT","UP","RIGHT","BOTTOM","mouseButtons","ORBIT","ZOOM","MIDDLE","PAN","rotateStart","rotateEnd","rotateDelta","panStart","panEnd","panDelta","dollyStart","dollyEnd","dollyDelta","STATE","state","target0","position0","zoom0","changeEvent","startEvent","endEvent","clientWidth","clientHeight","getZoomScale","pow","onMouseDown","preventDefault","button","clientX","clientY","onMouseMove","onMouseUp","dispatchEvent","subVectors","removeEventListener","onMouseWheel","stopPropagation","delta","wheelDelta","detail","onKeyDown","keyCode","touchstart","touches","pageX","pageY","dx","dy","touchmove","touchend","contextmenu","reset","dispose","EventDispatcher","noZoom","noRotate","noPan","noKeys","staticMoving","dynamicDampingFactor"],"mappings":"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","file":"main.bundle.js","sourcesContent":["import TWEEN from '@tweenjs/tween.js';\r\n\r\n// This object contains the state of the app\r\nexport default {\r\n  isDev: false,\r\n  isShowingStats: true,\r\n  isLoaded: false,\r\n  isTweening: false,\r\n  isRotating: true,\r\n  isMouseMoving: false,\r\n  isMouseOver: false,\r\n  maxAnisotropy: 1,\r\n  dpr: 1,\r\n  easing: TWEEN.Easing.Quadratic.InOut,\r\n  duration: 500,\r\n  model: {\r\n    selected: 0,\r\n    initialTypes: ['gltf', 'object'],\r\n    type: 'gltf'\r\n  },\r\n  models: [\r\n    {\r\n      path: './assets/models/duck.gltf',\r\n      scale: 20,\r\n      type: 'gltf'\r\n    },\r\n    {\r\n      path: './assets/models/Teapot.json',\r\n      scale: 20,\r\n      type: 'object'\r\n    }\r\n  ],\r\n  texture: {\r\n    path: './assets/textures/',\r\n    imageFiles: [\r\n      { name: 'UV', image: 'UV_Grid_Sm.jpg' }\r\n    ]\r\n  },\r\n  mesh: {\r\n    enableHelper: true,\r\n    wireframe: false,\r\n    translucent: false,\r\n    material: {\r\n      color: 0xffffff,\r\n      emissive: 0xffffff\r\n    }\r\n  },\r\n  fog: {\r\n    color: 0xffffff,\r\n    near: 0.0008\r\n  },\r\n  camera: {\r\n    fov: 40,\r\n    near: 2,\r\n    far: 1000,\r\n    aspect: 1,\r\n    posX: 0,\r\n    posY: 30,\r\n    posZ: 40\r\n  },\r\n  controls: {\r\n    autoRotate: false,\r\n    autoRotateSpeed: -0.5,\r\n    rotateSpeed: 0.5,\r\n    zoomSpeed: 0.8,\r\n    minDistance: 200,\r\n    maxDistance: 600,\r\n    minPolarAngle: Math.PI / 5,\r\n    maxPolarAngle: Math.PI / 2,\r\n    minAzimuthAngle: -Infinity,\r\n    maxAzimuthAngle: Infinity,\r\n    enableDamping: true,\r\n    dampingFactor: 0.5,\r\n    enableZoom: true,\r\n    target: {\r\n      x: 0,\r\n      y: 0,\r\n      z: 0\r\n    }\r\n  },\r\n  ambientLight: {\r\n    enabled: true,\r\n    color: 0x141414\r\n  },\r\n  directionalLight: {\r\n    enabled: true,\r\n    color: 0xf0f0f0,\r\n    intensity: 0.4,\r\n    x: -75,\r\n    y: 280,\r\n    z: 150\r\n  },\r\n  shadow: {\r\n    enabled: true,\r\n    helperEnabled: true,\r\n    bias: 0,\r\n    mapWidth: 2048,\r\n    mapHeight: 2048,\r\n    near: 250,\r\n    far: 400,\r\n    top: 100,\r\n    right: 100,\r\n    bottom: -100,\r\n    left: -100\r\n  },\r\n  pointLight: {\r\n    enabled: true,\r\n    color: 0xffffff,\r\n    intensity: 0.34,\r\n    distance: 115,\r\n    x: 0,\r\n    y: 0,\r\n    z: 0\r\n  },\r\n  hemiLight: {\r\n    enabled: true,\r\n    color: 0xc8c8c8,\r\n    groundColor: 0xffffff,\r\n    intensity: 0.55,\r\n    x: 0,\r\n    y: 0,\r\n    z: 0\r\n  }\r\n};\r\n","/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mr.doob / http://mrdoob.com/\r\n */\r\n\r\nexport default {\r\n  canvas: !!window.CanvasRenderingContext2D,\r\n  webgl: (function() {\r\n    try {\r\n      var canvas = document.createElement('canvas');\r\n\r\n      return !!(window.WebGLRenderingContext && (canvas.getContext('webgl') || canvas.getContext('experimental-webgl')));\r\n    } catch(e) {\r\n      return false;\r\n    }\r\n  })(),\r\n\r\n  workers: !!window.Worker,\r\n  fileapi: window.File && window.FileReader && window.FileList && window.Blob,\r\n\r\n  getWebGLErrorMessage: function() {\r\n    var element = document.createElement('div');\r\n    element.id = 'webgl-error-message';\r\n    element.style.fontFamily = 'monospace';\r\n    element.style.fontSize = '13px';\r\n    element.style.fontWeight = 'normal';\r\n    element.style.textAlign = 'center';\r\n    element.style.background = '#fff';\r\n    element.style.color = '#000';\r\n    element.style.padding = '1.5em';\r\n    element.style.width = '400px';\r\n    element.style.margin = '5em auto 0';\r\n\r\n    if(!this.webgl) {\r\n      element.innerHTML = window.WebGLRenderingContext ? [\r\n        'Your graphics card does not seem to support <a href=\"http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation\" style=\"color:#000000\">WebGL</a>.<br />',\r\n        'Find out how to get it <a href=\"http://get.webgl.org/\" style=\"color:#000000\">here</a>.'\r\n      ].join('\\n') : [\r\n        'Your browser does not seem to support <a href=\"http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation\" style=\"color:#000000\">WebGL</a>.<br/>',\r\n        'Find out how to get it <a href=\"http://get.webgl.org/\" style=\"color:#000000\">here</a>.'\r\n      ].join('\\n');\r\n    }\r\n\r\n    return element;\r\n  },\r\n\r\n  addGetWebGLMessage: function(parameters) {\r\n    var parent, id, element;\r\n\r\n    parameters = parameters || {};\r\n\r\n    parent = parameters.parent !== undefined ? parameters.parent : document.body;\r\n    id = parameters.id !== undefined ? parameters.id : 'oldie';\r\n\r\n    element = this.getWebGLErrorMessage();\r\n    element.id = id;\r\n\r\n    parent.appendChild(element);\r\n  }\r\n};\r\n","/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nimport {\r\n  BufferGeometry,\r\n  Float32BufferAttribute,\r\n  LineSegments,\r\n  LineBasicMaterial,\r\n  Matrix3,\r\n  Vector3,\r\n} from 'three';\r\n\r\nconst _v1 = new Vector3();\r\nconst _v2 = new Vector3();\r\nconst _normalMatrix = new Matrix3();\r\nconst _keys = ['a', 'b', 'c'];\r\n\r\nfunction VertexNormalsHelper(object, size, hex) {\r\n  this.object = object;\r\n  this.size = size !== undefined ? size : 0.1;\r\n\r\n  const color = hex !== undefined ? hex : 0xff0000;\r\n\r\n  //\r\n\r\n  let nNormals = 0;\r\n\r\n  const objGeometry = this.object.geometry;\r\n\r\n  if (objGeometry && objGeometry.isGeometry) {\r\n    nNormals = objGeometry.faces.length * 3;\r\n  } else if (objGeometry && objGeometry.isBufferGeometry) {\r\n    nNormals = objGeometry.attributes.normal.count;\r\n  }\r\n\r\n  //\r\n\r\n  const geometry = new BufferGeometry();\r\n  const positions = new Float32BufferAttribute(nNormals * 2 * 3, 3);\r\n\r\n  geometry.setAttribute('position', positions);\r\n\r\n  LineSegments.call(this, geometry, new LineBasicMaterial({ color: color, toneMapped: false }));\r\n\r\n  this.type = 'VertexNormalsHelper';\r\n\r\n  //\r\n\r\n  this.matrixAutoUpdate = false;\r\n\r\n  this.update();\r\n}\r\n\r\nVertexNormalsHelper.prototype = Object.create(LineSegments.prototype);\r\nVertexNormalsHelper.prototype.constructor = VertexNormalsHelper;\r\n\r\nVertexNormalsHelper.prototype.update = function () {\r\n  let idx;\r\n  this.object.updateMatrixWorld(true);\r\n\r\n  _normalMatrix.getNormalMatrix(this.object.matrixWorld);\r\n\r\n  const matrixWorld = this.object.matrixWorld;\r\n  const position = this.geometry.attributes.position;\r\n\r\n  //\r\n\r\n  const objGeometry = this.object.geometry;\r\n\r\n  if (objGeometry && objGeometry.isGeometry) {\r\n    const vertices = objGeometry.vertices;\r\n\r\n    const faces = objGeometry.faces;\r\n\r\n    idx = 0;\r\n\r\n    for (let i = 0, l = faces.length; i < l; i++) {\r\n      const face = faces[i];\r\n\r\n      for (let j = 0, jl = face.vertexNormals.length; j < jl; j++) {\r\n        const vertex = vertices[face[_keys[j]]];\r\n        const normal = face.vertexNormals[j];\r\n\r\n        _v1.copy(vertex).applyMatrix4(matrixWorld);\r\n        _v2.copy(normal).applyMatrix3(_normalMatrix).normalize().multiplyScalar(this.size).add(_v1);\r\n\r\n        position.setXYZ(idx, _v1.x, _v1.y, _v1.z);\r\n\r\n        idx = idx + 1;\r\n\r\n        position.setXYZ(idx, _v2.x, _v2.y, _v2.z);\r\n\r\n        idx = idx + 1;\r\n      }\r\n    }\r\n  } else if (objGeometry && objGeometry.isBufferGeometry) {\r\n    const objPos = objGeometry.attributes.position;\r\n    const objNorm = objGeometry.attributes.normal;\r\n\r\n    idx = 0;\r\n\r\n    // for simplicity, ignore index and drawcalls, and render every normal\r\n\r\n    for (var j = 0, jl = objPos.count; j < jl; j++) {\r\n      _v1.set(objPos.getX(j), objPos.getY(j), objPos.getZ(j)).applyMatrix4(matrixWorld);\r\n      _v2.set(objNorm.getX(j), objNorm.getY(j), objNorm.getZ(j));\r\n      _v2.applyMatrix3(_normalMatrix).normalize().multiplyScalar(this.size).add(_v1);\r\n\r\n      position.setXYZ(idx, _v1.x, _v1.y, _v1.z);\r\n\r\n      idx = idx + 1;\r\n\r\n      position.setXYZ(idx, _v2.x, _v2.y, _v2.z);\r\n\r\n      idx = idx + 1;\r\n    }\r\n  }\r\n\r\n  position.needsUpdate = true;\r\n};\r\n\r\nexport { VertexNormalsHelper };\r\n","/**\r\n * @author Rich Tibbett / https://github.com/richtr\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author Tony Parisi / http://www.tonyparisi.com/\r\n * @author Takahiro / https://github.com/takahirox\r\n * @author Don McCurdy / https://www.donmccurdy.com\r\n */\r\n\r\nimport {\r\n  AnimationClip,\r\n  Bone,\r\n  Box3,\r\n  BufferAttribute,\r\n  BufferGeometry,\r\n  ClampToEdgeWrapping,\r\n  Color,\r\n  DirectionalLight,\r\n  DoubleSide,\r\n  FileLoader,\r\n  FrontSide,\r\n  Group,\r\n  InterleavedBuffer,\r\n  InterleavedBufferAttribute,\r\n  Interpolant,\r\n  InterpolateDiscrete,\r\n  InterpolateLinear,\r\n  Line,\r\n  LineBasicMaterial,\r\n  LineLoop,\r\n  LineSegments,\r\n  LinearFilter,\r\n  LinearMipmapLinearFilter,\r\n  LinearMipmapNearestFilter,\r\n  Loader,\r\n  LoaderUtils,\r\n  Material,\r\n  MathUtils,\r\n  Matrix4,\r\n  Mesh,\r\n  MeshBasicMaterial,\r\n  MeshPhysicalMaterial,\r\n  MeshStandardMaterial,\r\n  MirroredRepeatWrapping,\r\n  NearestFilter,\r\n  NearestMipmapLinearFilter,\r\n  NearestMipmapNearestFilter,\r\n  NumberKeyframeTrack,\r\n  Object3D,\r\n  OrthographicCamera,\r\n  PerspectiveCamera,\r\n  PointLight,\r\n  Points,\r\n  PointsMaterial,\r\n  PropertyBinding,\r\n  QuaternionKeyframeTrack,\r\n  RGBAFormat,\r\n  RGBFormat,\r\n  RepeatWrapping,\r\n  Skeleton,\r\n  SkinnedMesh,\r\n  Sphere,\r\n  SpotLight,\r\n  TangentSpaceNormalMap,\r\n  TextureLoader,\r\n  TriangleFanDrawMode,\r\n  TriangleStripDrawMode,\r\n  Vector2,\r\n  Vector3,\r\n  VectorKeyframeTrack,\r\n  sRGBEncoding\r\n} from 'three';\r\n\r\nconst GLTFLoader = (function () {\r\n  function GLTFLoader(manager) {\r\n    Loader.call(this, manager);\r\n\r\n    this.dracoLoader = null;\r\n    this.ddsLoader = null;\r\n  }\r\n\r\n  GLTFLoader.prototype = Object.assign(Object.create(Loader.prototype), {\r\n    constructor: GLTFLoader,\r\n\r\n    load: function (url, onLoad, onProgress, onError) {\r\n      var scope = this;\r\n\r\n      var resourcePath;\r\n\r\n      if (this.resourcePath !== '') {\r\n        resourcePath = this.resourcePath;\r\n      } else if (this.path !== '') {\r\n        resourcePath = this.path;\r\n      } else {\r\n        resourcePath = LoaderUtils.extractUrlBase(url);\r\n      }\r\n\r\n      // Tells the LoadingManager to track an extra item, which resolves after\r\n      // the model is fully loaded. This means the count of items loaded will\r\n      // be incorrect, but ensures manager.onLoad() does not fire early.\r\n      scope.manager.itemStart(url);\r\n\r\n      var _onError = function (e) {\r\n        if (onError) {\r\n          onError(e);\r\n        } else {\r\n          console.error(e);\r\n        }\r\n\r\n        scope.manager.itemError(url);\r\n        scope.manager.itemEnd(url);\r\n      };\r\n\r\n      var loader = new FileLoader(scope.manager);\r\n\r\n      loader.setPath(this.path);\r\n      loader.setResponseType('arraybuffer');\r\n\r\n      if (scope.crossOrigin === 'use-credentials') {\r\n        loader.setWithCredentials(true);\r\n      }\r\n\r\n      loader.load(\r\n        url,\r\n        function (data) {\r\n          try {\r\n            scope.parse(\r\n              data,\r\n              resourcePath,\r\n              function (gltf) {\r\n                onLoad(gltf);\r\n\r\n                scope.manager.itemEnd(url);\r\n              },\r\n              _onError\r\n            );\r\n          } catch (e) {\r\n            _onError(e);\r\n          }\r\n        },\r\n        onProgress,\r\n        _onError\r\n      );\r\n    },\r\n\r\n    setDRACOLoader: function (dracoLoader) {\r\n      this.dracoLoader = dracoLoader;\r\n      return this;\r\n    },\r\n\r\n    setDDSLoader: function (ddsLoader) {\r\n      this.ddsLoader = ddsLoader;\r\n      return this;\r\n    },\r\n\r\n    parse: function (data, path, onLoad, onError) {\r\n      var content;\r\n      var extensions = {};\r\n\r\n      if (typeof data === 'string') {\r\n        content = data;\r\n      } else {\r\n        var magic = LoaderUtils.decodeText(new Uint8Array(data, 0, 4));\r\n\r\n        if (magic === BINARY_EXTENSION_HEADER_MAGIC) {\r\n          try {\r\n            extensions[EXTENSIONS.KHR_BINARY_GLTF] = new GLTFBinaryExtension(data);\r\n          } catch (error) {\r\n            if (onError) onError(error);\r\n            return;\r\n          }\r\n\r\n          content = extensions[EXTENSIONS.KHR_BINARY_GLTF].content;\r\n        } else {\r\n          content = LoaderUtils.decodeText(new Uint8Array(data));\r\n        }\r\n      }\r\n\r\n      var json = JSON.parse(content);\r\n\r\n      if (json.asset === undefined || json.asset.version[0] < 2) {\r\n        if (onError)\r\n          onError(\r\n            new Error('THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.')\r\n          );\r\n        return;\r\n      }\r\n\r\n      if (json.extensionsUsed) {\r\n        for (var i = 0; i < json.extensionsUsed.length; ++i) {\r\n          var extensionName = json.extensionsUsed[i];\r\n          var extensionsRequired = json.extensionsRequired || [];\r\n\r\n          switch (extensionName) {\r\n            case EXTENSIONS.KHR_LIGHTS_PUNCTUAL:\r\n              extensions[extensionName] = new GLTFLightsExtension(json);\r\n              break;\r\n\r\n            case EXTENSIONS.KHR_MATERIALS_CLEARCOAT:\r\n              extensions[extensionName] = new GLTFMaterialsClearcoatExtension();\r\n              break;\r\n\r\n            case EXTENSIONS.KHR_MATERIALS_UNLIT:\r\n              extensions[extensionName] = new GLTFMaterialsUnlitExtension();\r\n              break;\r\n\r\n            case EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:\r\n              extensions[extensionName] = new GLTFMaterialsPbrSpecularGlossinessExtension();\r\n              break;\r\n\r\n            case EXTENSIONS.KHR_DRACO_MESH_COMPRESSION:\r\n              extensions[extensionName] = new GLTFDracoMeshCompressionExtension(\r\n                json,\r\n                this.dracoLoader\r\n              );\r\n              break;\r\n\r\n            case EXTENSIONS.MSFT_TEXTURE_DDS:\r\n              extensions[extensionName] = new GLTFTextureDDSExtension(this.ddsLoader);\r\n              break;\r\n\r\n            case EXTENSIONS.KHR_TEXTURE_TRANSFORM:\r\n              extensions[extensionName] = new GLTFTextureTransformExtension();\r\n              break;\r\n\r\n            case EXTENSIONS.KHR_MESH_QUANTIZATION:\r\n              extensions[extensionName] = new GLTFMeshQuantizationExtension();\r\n              break;\r\n\r\n            default:\r\n              if (extensionsRequired.indexOf(extensionName) >= 0) {\r\n                console.warn('THREE.GLTFLoader: Unknown extension \"' + extensionName + '\".');\r\n              }\r\n          }\r\n        }\r\n      }\r\n\r\n      var parser = new GLTFParser(json, extensions, {\r\n        path: path || this.resourcePath || '',\r\n        crossOrigin: this.crossOrigin,\r\n        manager: this.manager\r\n      });\r\n\r\n      parser.parse(onLoad, onError);\r\n    },\r\n  });\r\n\r\n  /* GLTFREGISTRY */\r\n\r\n  function GLTFRegistry() {\r\n    var objects = {};\r\n\r\n    return {\r\n      get: function (key) {\r\n        return objects[key];\r\n      },\r\n\r\n      add: function (key, object) {\r\n        objects[key] = object;\r\n      },\r\n\r\n      remove: function (key) {\r\n        delete objects[key];\r\n      },\r\n\r\n      removeAll: function () {\r\n        objects = {};\r\n      },\r\n    };\r\n  }\r\n\r\n  /*********************************/\r\n  /********** EXTENSIONS ***********/\r\n  /*********************************/\r\n\r\n  var EXTENSIONS = {\r\n    KHR_BINARY_GLTF: 'KHR_binary_glTF',\r\n    KHR_DRACO_MESH_COMPRESSION: 'KHR_draco_mesh_compression',\r\n    KHR_LIGHTS_PUNCTUAL: 'KHR_lights_punctual',\r\n    KHR_MATERIALS_CLEARCOAT: 'KHR_materials_clearcoat',\r\n    KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS: 'KHR_materials_pbrSpecularGlossiness',\r\n    KHR_MATERIALS_UNLIT: 'KHR_materials_unlit',\r\n    KHR_TEXTURE_TRANSFORM: 'KHR_texture_transform',\r\n    KHR_MESH_QUANTIZATION: 'KHR_mesh_quantization',\r\n    MSFT_TEXTURE_DDS: 'MSFT_texture_dds'\r\n  };\r\n\r\n  /**\r\n   * DDS Texture Extension\r\n   *\r\n   * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/MSFT_texture_dds\r\n   *\r\n   */\r\n  function GLTFTextureDDSExtension(ddsLoader) {\r\n    if (!ddsLoader) {\r\n      throw new Error(\r\n        'THREE.GLTFLoader: Attempting to load .dds texture without importing DDSLoader'\r\n      );\r\n    }\r\n\r\n    this.name = EXTENSIONS.MSFT_TEXTURE_DDS;\r\n    this.ddsLoader = ddsLoader;\r\n  }\r\n\r\n  /**\r\n   * Punctual Lights Extension\r\n   *\r\n   * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_lights_punctual\r\n   */\r\n  function GLTFLightsExtension(json) {\r\n    this.name = EXTENSIONS.KHR_LIGHTS_PUNCTUAL;\r\n\r\n    var extension = (json.extensions && json.extensions[EXTENSIONS.KHR_LIGHTS_PUNCTUAL]) || {};\r\n    this.lightDefs = extension.lights || [];\r\n  }\r\n\r\n  GLTFLightsExtension.prototype.loadLight = function (lightIndex) {\r\n    var lightDef = this.lightDefs[lightIndex];\r\n    var lightNode;\r\n\r\n    var color = new Color(0xffffff);\r\n    if (lightDef.color !== undefined) color.fromArray(lightDef.color);\r\n\r\n    var range = lightDef.range !== undefined ? lightDef.range : 0;\r\n\r\n    switch (lightDef.type) {\r\n      case 'directional':\r\n        lightNode = new DirectionalLight(color);\r\n        lightNode.target.position.set(0, 0, -1);\r\n        lightNode.add(lightNode.target);\r\n        break;\r\n\r\n      case 'point':\r\n        lightNode = new PointLight(color);\r\n        lightNode.distance = range;\r\n        break;\r\n\r\n      case 'spot':\r\n        lightNode = new SpotLight(color);\r\n        lightNode.distance = range;\r\n        // Handle spotlight properties.\r\n        lightDef.spot = lightDef.spot || {};\r\n        lightDef.spot.innerConeAngle =\r\n          lightDef.spot.innerConeAngle !== undefined ? lightDef.spot.innerConeAngle : 0;\r\n        lightDef.spot.outerConeAngle =\r\n          lightDef.spot.outerConeAngle !== undefined ? lightDef.spot.outerConeAngle : Math.PI / 4.0;\r\n        lightNode.angle = lightDef.spot.outerConeAngle;\r\n        lightNode.penumbra = 1.0 - lightDef.spot.innerConeAngle / lightDef.spot.outerConeAngle;\r\n        lightNode.target.position.set(0, 0, -1);\r\n        lightNode.add(lightNode.target);\r\n        break;\r\n\r\n      default:\r\n        throw new Error('THREE.GLTFLoader: Unexpected light type, \"' + lightDef.type + '\".');\r\n    }\r\n\r\n    // Some lights (e.g. spot) default to a position other than the origin. Reset the position\r\n    // here, because node-level parsing will only override position if explicitly specified.\r\n    lightNode.position.set(0, 0, 0);\r\n\r\n    lightNode.decay = 2;\r\n\r\n    if (lightDef.intensity !== undefined) lightNode.intensity = lightDef.intensity;\r\n\r\n    lightNode.name = lightDef.name || 'light_' + lightIndex;\r\n\r\n    return Promise.resolve(lightNode);\r\n  };\r\n\r\n  /**\r\n   * Unlit Materials Extension\r\n   *\r\n   * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_unlit\r\n   */\r\n  function GLTFMaterialsUnlitExtension() {\r\n    this.name = EXTENSIONS.KHR_MATERIALS_UNLIT;\r\n  }\r\n\r\n  GLTFMaterialsUnlitExtension.prototype.getMaterialType = function () {\r\n    return MeshBasicMaterial;\r\n  };\r\n\r\n  GLTFMaterialsUnlitExtension.prototype.extendParams = function (\r\n    materialParams,\r\n    materialDef,\r\n    parser\r\n  ) {\r\n    var pending = [];\r\n\r\n    materialParams.color = new Color(1.0, 1.0, 1.0);\r\n    materialParams.opacity = 1.0;\r\n\r\n    var metallicRoughness = materialDef.pbrMetallicRoughness;\r\n\r\n    if (metallicRoughness) {\r\n      if (Array.isArray(metallicRoughness.baseColorFactor)) {\r\n        var array = metallicRoughness.baseColorFactor;\r\n\r\n        materialParams.color.fromArray(array);\r\n        materialParams.opacity = array[3];\r\n      }\r\n\r\n      if (metallicRoughness.baseColorTexture !== undefined) {\r\n        pending.push(\r\n          parser.assignTexture(materialParams, 'map', metallicRoughness.baseColorTexture)\r\n        );\r\n      }\r\n    }\r\n\r\n    return Promise.all(pending);\r\n  };\r\n\r\n  /**\r\n   * Clearcoat Materials Extension\r\n   *\r\n   * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_clearcoat\r\n   */\r\n  function GLTFMaterialsClearcoatExtension() {\r\n    this.name = EXTENSIONS.KHR_MATERIALS_CLEARCOAT;\r\n  }\r\n\r\n  GLTFMaterialsClearcoatExtension.prototype.getMaterialType = function () {\r\n    return MeshPhysicalMaterial;\r\n  };\r\n\r\n  GLTFMaterialsClearcoatExtension.prototype.extendParams = function (\r\n    materialParams,\r\n    materialDef,\r\n    parser\r\n  ) {\r\n    var pending = [];\r\n\r\n    var extension = materialDef.extensions[this.name];\r\n\r\n    if (extension.clearcoatFactor !== undefined) {\r\n      materialParams.clearcoat = extension.clearcoatFactor;\r\n    }\r\n\r\n    if (extension.clearcoatTexture !== undefined) {\r\n      pending.push(\r\n        parser.assignTexture(materialParams, 'clearcoatMap', extension.clearcoatTexture)\r\n      );\r\n    }\r\n\r\n    if (extension.clearcoatRoughnessFactor !== undefined) {\r\n      materialParams.clearcoatRoughness = extension.clearcoatRoughnessFactor;\r\n    }\r\n\r\n    if (extension.clearcoatRoughnessTexture !== undefined) {\r\n      pending.push(\r\n        parser.assignTexture(\r\n          materialParams,\r\n          'clearcoatRoughnessMap',\r\n          extension.clearcoatRoughnessTexture\r\n        )\r\n      );\r\n    }\r\n\r\n    if (extension.clearcoatNormalTexture !== undefined) {\r\n      pending.push(\r\n        parser.assignTexture(\r\n          materialParams,\r\n          'clearcoatNormalMap',\r\n          extension.clearcoatNormalTexture\r\n        )\r\n      );\r\n\r\n      if (extension.clearcoatNormalTexture.scale !== undefined) {\r\n        var scale = extension.clearcoatNormalTexture.scale;\r\n\r\n        materialParams.clearcoatNormalScale = new Vector2(scale, scale);\r\n      }\r\n    }\r\n\r\n    return Promise.all(pending);\r\n  };\r\n\r\n  /* BINARY EXTENSION */\r\n  var BINARY_EXTENSION_HEADER_MAGIC = 'glTF';\r\n  var BINARY_EXTENSION_HEADER_LENGTH = 12;\r\n  var BINARY_EXTENSION_CHUNK_TYPES = { JSON: 0x4e4f534a, BIN: 0x004e4942 };\r\n\r\n  function GLTFBinaryExtension(data) {\r\n    this.name = EXTENSIONS.KHR_BINARY_GLTF;\r\n    this.content = null;\r\n    this.body = null;\r\n\r\n    var headerView = new DataView(data, 0, BINARY_EXTENSION_HEADER_LENGTH);\r\n\r\n    this.header = {\r\n      magic: LoaderUtils.decodeText(new Uint8Array(data.slice(0, 4))),\r\n      version: headerView.getUint32(4, true),\r\n      length: headerView.getUint32(8, true)\r\n    };\r\n\r\n    if (this.header.magic !== BINARY_EXTENSION_HEADER_MAGIC) {\r\n      throw new Error('THREE.GLTFLoader: Unsupported glTF-Binary header.');\r\n    } else if (this.header.version < 2.0) {\r\n      throw new Error('THREE.GLTFLoader: Legacy binary file detected.');\r\n    }\r\n\r\n    var chunkView = new DataView(data, BINARY_EXTENSION_HEADER_LENGTH);\r\n    var chunkIndex = 0;\r\n\r\n    while (chunkIndex < chunkView.byteLength) {\r\n      var chunkLength = chunkView.getUint32(chunkIndex, true);\r\n      chunkIndex += 4;\r\n\r\n      var chunkType = chunkView.getUint32(chunkIndex, true);\r\n      chunkIndex += 4;\r\n\r\n      if (chunkType === BINARY_EXTENSION_CHUNK_TYPES.JSON) {\r\n        var contentArray = new Uint8Array(\r\n          data,\r\n          BINARY_EXTENSION_HEADER_LENGTH + chunkIndex,\r\n          chunkLength\r\n        );\r\n        this.content = LoaderUtils.decodeText(contentArray);\r\n      } else if (chunkType === BINARY_EXTENSION_CHUNK_TYPES.BIN) {\r\n        var byteOffset = BINARY_EXTENSION_HEADER_LENGTH + chunkIndex;\r\n        this.body = data.slice(byteOffset, byteOffset + chunkLength);\r\n      }\r\n\r\n      // Clients must ignore chunks with unknown types.\r\n\r\n      chunkIndex += chunkLength;\r\n    }\r\n\r\n    if (this.content === null) {\r\n      throw new Error('THREE.GLTFLoader: JSON content not found.');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * DRACO Mesh Compression Extension\r\n   *\r\n   * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_draco_mesh_compression\r\n   */\r\n  function GLTFDracoMeshCompressionExtension(json, dracoLoader) {\r\n    if (!dracoLoader) {\r\n      throw new Error('THREE.GLTFLoader: No DRACOLoader instance provided.');\r\n    }\r\n\r\n    this.name = EXTENSIONS.KHR_DRACO_MESH_COMPRESSION;\r\n    this.json = json;\r\n    this.dracoLoader = dracoLoader;\r\n    this.dracoLoader.preload();\r\n  }\r\n\r\n  GLTFDracoMeshCompressionExtension.prototype.decodePrimitive = function (primitive, parser) {\r\n    var json = this.json;\r\n    var dracoLoader = this.dracoLoader;\r\n    var bufferViewIndex = primitive.extensions[this.name].bufferView;\r\n    var gltfAttributeMap = primitive.extensions[this.name].attributes;\r\n    var threeAttributeMap = {};\r\n    var attributeNormalizedMap = {};\r\n    var attributeTypeMap = {};\r\n\r\n    for (var attributeName in gltfAttributeMap) {\r\n      var threeAttributeName = ATTRIBUTES[attributeName] || attributeName.toLowerCase();\r\n\r\n      threeAttributeMap[threeAttributeName] = gltfAttributeMap[attributeName];\r\n    }\r\n\r\n    for (attributeName in primitive.attributes) {\r\n      var threeAttributeName = ATTRIBUTES[attributeName] || attributeName.toLowerCase();\r\n\r\n      if (gltfAttributeMap[attributeName] !== undefined) {\r\n        var accessorDef = json.accessors[primitive.attributes[attributeName]];\r\n        var componentType = WEBGL_COMPONENT_TYPES[accessorDef.componentType];\r\n\r\n        attributeTypeMap[threeAttributeName] = componentType;\r\n        attributeNormalizedMap[threeAttributeName] = accessorDef.normalized === true;\r\n      }\r\n    }\r\n\r\n    return parser.getDependency('bufferView', bufferViewIndex).then(function (bufferView) {\r\n      return new Promise(function (resolve) {\r\n        dracoLoader.decodeDracoFile(\r\n          bufferView,\r\n          function (geometry) {\r\n            for (var attributeName in geometry.attributes) {\r\n              var attribute = geometry.attributes[attributeName];\r\n              var normalized = attributeNormalizedMap[attributeName];\r\n\r\n              if (normalized !== undefined) attribute.normalized = normalized;\r\n            }\r\n\r\n            resolve(geometry);\r\n          },\r\n          threeAttributeMap,\r\n          attributeTypeMap\r\n        );\r\n      });\r\n    });\r\n  };\r\n\r\n  /**\r\n   * Texture Transform Extension\r\n   *\r\n   * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_texture_transform\r\n   */\r\n  function GLTFTextureTransformExtension() {\r\n    this.name = EXTENSIONS.KHR_TEXTURE_TRANSFORM;\r\n  }\r\n\r\n  GLTFTextureTransformExtension.prototype.extendTexture = function (texture, transform) {\r\n    texture = texture.clone();\r\n\r\n    if (transform.offset !== undefined) {\r\n      texture.offset.fromArray(transform.offset);\r\n    }\r\n\r\n    if (transform.rotation !== undefined) {\r\n      texture.rotation = transform.rotation;\r\n    }\r\n\r\n    if (transform.scale !== undefined) {\r\n      texture.repeat.fromArray(transform.scale);\r\n    }\r\n\r\n    if (transform.texCoord !== undefined) {\r\n      console.warn(\r\n        'THREE.GLTFLoader: Custom UV sets in \"' + this.name + '\" extension not yet supported.'\r\n      );\r\n    }\r\n\r\n    texture.needsUpdate = true;\r\n\r\n    return texture;\r\n  };\r\n\r\n  /**\r\n   * Specular-Glossiness Extension\r\n   *\r\n   * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_pbrSpecularGlossiness\r\n   */\r\n\r\n  /**\r\n   * A sub class of StandardMaterial with some of the functionality\r\n   * changed via the `onBeforeCompile` callback\r\n   * @pailhead\r\n   */\r\n\r\n  function GLTFMeshStandardSGMaterial(params) {\r\n    MeshStandardMaterial.call(this);\r\n\r\n    this.isGLTFSpecularGlossinessMaterial = true;\r\n\r\n    //various chunks that need replacing\r\n    var specularMapParsFragmentChunk = [\r\n      '#ifdef USE_SPECULARMAP',\r\n      '\tuniform sampler2D specularMap;',\r\n      '#endif',\r\n    ].join('\\n');\r\n\r\n    var glossinessMapParsFragmentChunk = [\r\n      '#ifdef USE_GLOSSINESSMAP',\r\n      '\tuniform sampler2D glossinessMap;',\r\n      '#endif',\r\n    ].join('\\n');\r\n\r\n    var specularMapFragmentChunk = [\r\n      'vec3 specularFactor = specular;',\r\n      '#ifdef USE_SPECULARMAP',\r\n      '\tvec4 texelSpecular = texture2D( specularMap, vUv );',\r\n      '\ttexelSpecular = sRGBToLinear( texelSpecular );',\r\n      '\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture',\r\n      '\tspecularFactor *= texelSpecular.rgb;',\r\n      '#endif',\r\n    ].join('\\n');\r\n\r\n    var glossinessMapFragmentChunk = [\r\n      'float glossinessFactor = glossiness;',\r\n      '#ifdef USE_GLOSSINESSMAP',\r\n      '\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );',\r\n      '\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture',\r\n      '\tglossinessFactor *= texelGlossiness.a;',\r\n      '#endif',\r\n    ].join('\\n');\r\n\r\n    var lightPhysicalFragmentChunk = [\r\n      'PhysicalMaterial material;',\r\n      'material.diffuseColor = diffuseColor.rgb;',\r\n      'vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );',\r\n      'float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );',\r\n      'material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 );// 0.0525 corresponds to the base mip of a 256 cubemap.',\r\n      'material.specularRoughness += geometryRoughness;',\r\n      'material.specularRoughness = min( material.specularRoughness, 1.0 );',\r\n      'material.specularColor = specularFactor.rgb;',\r\n    ].join('\\n');\r\n\r\n    var uniforms = {\r\n      specular: { value: new Color().setHex(0xffffff) },\r\n      glossiness: { value: 1 },\r\n      specularMap: { value: null },\r\n      glossinessMap: { value: null },\r\n    };\r\n\r\n    this._extraUniforms = uniforms;\r\n\r\n    // please see #14031 or #13198 for an alternate approach\r\n    this.onBeforeCompile = function (shader) {\r\n      for (var uniformName in uniforms) {\r\n        shader.uniforms[uniformName] = uniforms[uniformName];\r\n      }\r\n\r\n      shader.fragmentShader = shader.fragmentShader.replace(\r\n        'uniform float roughness;',\r\n        'uniform vec3 specular;'\r\n      );\r\n      shader.fragmentShader = shader.fragmentShader.replace(\r\n        'uniform float metalness;',\r\n        'uniform float glossiness;'\r\n      );\r\n      shader.fragmentShader = shader.fragmentShader.replace(\r\n        '#include <roughnessmap_pars_fragment>',\r\n        specularMapParsFragmentChunk\r\n      );\r\n      shader.fragmentShader = shader.fragmentShader.replace(\r\n        '#include <metalnessmap_pars_fragment>',\r\n        glossinessMapParsFragmentChunk\r\n      );\r\n      shader.fragmentShader = shader.fragmentShader.replace(\r\n        '#include <roughnessmap_fragment>',\r\n        specularMapFragmentChunk\r\n      );\r\n      shader.fragmentShader = shader.fragmentShader.replace(\r\n        '#include <metalnessmap_fragment>',\r\n        glossinessMapFragmentChunk\r\n      );\r\n      shader.fragmentShader = shader.fragmentShader.replace(\r\n        '#include <lights_physical_fragment>',\r\n        lightPhysicalFragmentChunk\r\n      );\r\n    };\r\n\r\n    /*eslint-disable*/\r\n    Object.defineProperties(this, {\r\n      specular: {\r\n        get: function () {\r\n          return uniforms.specular.value;\r\n        },\r\n        set: function (v) {\r\n          uniforms.specular.value = v;\r\n        },\r\n      },\r\n      specularMap: {\r\n        get: function () {\r\n          return uniforms.specularMap.value;\r\n        },\r\n        set: function (v) {\r\n          uniforms.specularMap.value = v;\r\n        },\r\n      },\r\n      glossiness: {\r\n        get: function () {\r\n          return uniforms.glossiness.value;\r\n        },\r\n        set: function (v) {\r\n          uniforms.glossiness.value = v;\r\n        },\r\n      },\r\n      glossinessMap: {\r\n        get: function () {\r\n          return uniforms.glossinessMap.value;\r\n        },\r\n        set: function (v) {\r\n          uniforms.glossinessMap.value = v;\r\n          //how about something like this - @pailhead\r\n          if (v) {\r\n            this.defines.USE_GLOSSINESSMAP = '';\r\n            // set USE_ROUGHNESSMAP to enable vUv\r\n            this.defines.USE_ROUGHNESSMAP = '';\r\n          } else {\r\n            delete this.defines.USE_ROUGHNESSMAP;\r\n            delete this.defines.USE_GLOSSINESSMAP;\r\n          }\r\n        },\r\n      },\r\n    });\r\n\r\n    /*eslint-enable*/\r\n    delete this.metalness;\r\n    delete this.roughness;\r\n    delete this.metalnessMap;\r\n    delete this.roughnessMap;\r\n\r\n    this.setValues(params);\r\n  }\r\n\r\n  GLTFMeshStandardSGMaterial.prototype = Object.create(MeshStandardMaterial.prototype);\r\n  GLTFMeshStandardSGMaterial.prototype.constructor = GLTFMeshStandardSGMaterial;\r\n\r\n  GLTFMeshStandardSGMaterial.prototype.copy = function (source) {\r\n    MeshStandardMaterial.prototype.copy.call(this, source);\r\n    this.specularMap = source.specularMap;\r\n    this.specular.copy(source.specular);\r\n    this.glossinessMap = source.glossinessMap;\r\n    this.glossiness = source.glossiness;\r\n    delete this.metalness;\r\n    delete this.roughness;\r\n    delete this.metalnessMap;\r\n    delete this.roughnessMap;\r\n    return this;\r\n  };\r\n\r\n  function GLTFMaterialsPbrSpecularGlossinessExtension() {\r\n    return {\r\n      name: EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,\r\n\r\n      specularGlossinessParams: [\r\n        'color',\r\n        'map',\r\n        'lightMap',\r\n        'lightMapIntensity',\r\n        'aoMap',\r\n        'aoMapIntensity',\r\n        'emissive',\r\n        'emissiveIntensity',\r\n        'emissiveMap',\r\n        'bumpMap',\r\n        'bumpScale',\r\n        'normalMap',\r\n        'normalMapType',\r\n        'displacementMap',\r\n        'displacementScale',\r\n        'displacementBias',\r\n        'specularMap',\r\n        'specular',\r\n        'glossinessMap',\r\n        'glossiness',\r\n        'alphaMap',\r\n        'envMap',\r\n        'envMapIntensity',\r\n        'refractionRatio',\r\n      ],\r\n\r\n      getMaterialType: function () {\r\n        return GLTFMeshStandardSGMaterial;\r\n      },\r\n\r\n      extendParams: function (materialParams, materialDef, parser) {\r\n        var pbrSpecularGlossiness = materialDef.extensions[this.name];\r\n\r\n        materialParams.color = new Color(1.0, 1.0, 1.0);\r\n        materialParams.opacity = 1.0;\r\n\r\n        var pending = [];\r\n\r\n        if (Array.isArray(pbrSpecularGlossiness.diffuseFactor)) {\r\n          var array = pbrSpecularGlossiness.diffuseFactor;\r\n\r\n          materialParams.color.fromArray(array);\r\n          materialParams.opacity = array[3];\r\n        }\r\n\r\n        if (pbrSpecularGlossiness.diffuseTexture !== undefined) {\r\n          pending.push(\r\n            parser.assignTexture(materialParams, 'map', pbrSpecularGlossiness.diffuseTexture)\r\n          );\r\n        }\r\n\r\n        materialParams.emissive = new Color(0.0, 0.0, 0.0);\r\n        materialParams.glossiness =\r\n          pbrSpecularGlossiness.glossinessFactor !== undefined\r\n            ? pbrSpecularGlossiness.glossinessFactor\r\n            : 1.0;\r\n        materialParams.specular = new Color(1.0, 1.0, 1.0);\r\n\r\n        if (Array.isArray(pbrSpecularGlossiness.specularFactor)) {\r\n          materialParams.specular.fromArray(pbrSpecularGlossiness.specularFactor);\r\n        }\r\n\r\n        if (pbrSpecularGlossiness.specularGlossinessTexture !== undefined) {\r\n          var specGlossMapDef = pbrSpecularGlossiness.specularGlossinessTexture;\r\n          pending.push(parser.assignTexture(materialParams, 'glossinessMap', specGlossMapDef));\r\n          pending.push(parser.assignTexture(materialParams, 'specularMap', specGlossMapDef));\r\n        }\r\n\r\n        return Promise.all(pending);\r\n      },\r\n\r\n      createMaterial: function (materialParams) {\r\n        var material = new GLTFMeshStandardSGMaterial(materialParams);\r\n        material.fog = true;\r\n\r\n        material.color = materialParams.color;\r\n\r\n        material.map = materialParams.map === undefined ? null : materialParams.map;\r\n\r\n        material.lightMap = null;\r\n        material.lightMapIntensity = 1.0;\r\n\r\n        material.aoMap = materialParams.aoMap === undefined ? null : materialParams.aoMap;\r\n        material.aoMapIntensity = 1.0;\r\n\r\n        material.emissive = materialParams.emissive;\r\n        material.emissiveIntensity = 1.0;\r\n        material.emissiveMap =\r\n          materialParams.emissiveMap === undefined ? null : materialParams.emissiveMap;\r\n\r\n        material.bumpMap = materialParams.bumpMap === undefined ? null : materialParams.bumpMap;\r\n        material.bumpScale = 1;\r\n\r\n        material.normalMap =\r\n          materialParams.normalMap === undefined ? null : materialParams.normalMap;\r\n        material.normalMapType = TangentSpaceNormalMap;\r\n\r\n        if (materialParams.normalScale) material.normalScale = materialParams.normalScale;\r\n\r\n        material.displacementMap = null;\r\n        material.displacementScale = 1;\r\n        material.displacementBias = 0;\r\n\r\n        material.specularMap =\r\n          materialParams.specularMap === undefined ? null : materialParams.specularMap;\r\n        material.specular = materialParams.specular;\r\n\r\n        material.glossinessMap =\r\n          materialParams.glossinessMap === undefined ? null : materialParams.glossinessMap;\r\n        material.glossiness = materialParams.glossiness;\r\n\r\n        material.alphaMap = null;\r\n\r\n        material.envMap = materialParams.envMap === undefined ? null : materialParams.envMap;\r\n        material.envMapIntensity = 1.0;\r\n\r\n        material.refractionRatio = 0.98;\r\n\r\n        return material;\r\n      },\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Mesh Quantization Extension\r\n   *\r\n   * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_mesh_quantization\r\n   */\r\n  function GLTFMeshQuantizationExtension() {\r\n    this.name = EXTENSIONS.KHR_MESH_QUANTIZATION;\r\n  }\r\n\r\n  /*********************************/\r\n  /********** INTERPOLATION ********/\r\n  /*********************************/\r\n\r\n  // Spline Interpolation\r\n  // Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#appendix-c-spline-interpolation\r\n  function GLTFCubicSplineInterpolant(parameterPositions, sampleValues, sampleSize, resultBuffer) {\r\n    Interpolant.call(this, parameterPositions, sampleValues, sampleSize, resultBuffer);\r\n  }\r\n\r\n  GLTFCubicSplineInterpolant.prototype = Object.create(Interpolant.prototype);\r\n  GLTFCubicSplineInterpolant.prototype.constructor = GLTFCubicSplineInterpolant;\r\n\r\n  GLTFCubicSplineInterpolant.prototype.copySampleValue_ = function (index) {\r\n    // Copies a sample value to the result buffer. See description of glTF\r\n    // CUBICSPLINE values layout in interpolate_() function below.\r\n\r\n    var result = this.resultBuffer,\r\n        values = this.sampleValues,\r\n        valueSize = this.valueSize,\r\n        offset = index * valueSize * 3 + valueSize;\r\n\r\n    for (var i = 0; i !== valueSize; i++) {\r\n      result[i] = values[offset + i];\r\n    }\r\n\r\n    return result;\r\n  };\r\n\r\n  GLTFCubicSplineInterpolant.prototype.beforeStart_ =\r\n    GLTFCubicSplineInterpolant.prototype.copySampleValue_;\r\n\r\n  GLTFCubicSplineInterpolant.prototype.afterEnd_ =\r\n    GLTFCubicSplineInterpolant.prototype.copySampleValue_;\r\n\r\n  GLTFCubicSplineInterpolant.prototype.interpolate_ = function (i1, t0, t, t1) {\r\n    var result = this.resultBuffer;\r\n    var values = this.sampleValues;\r\n    var stride = this.valueSize;\r\n\r\n    var stride2 = stride * 2;\r\n    var stride3 = stride * 3;\r\n\r\n    var td = t1 - t0;\r\n\r\n    var p = (t - t0) / td;\r\n    var pp = p * p;\r\n    var ppp = pp * p;\r\n\r\n    var offset1 = i1 * stride3;\r\n    var offset0 = offset1 - stride3;\r\n\r\n    var s2 = -2 * ppp + 3 * pp;\r\n    var s3 = ppp - pp;\r\n    var s0 = 1 - s2;\r\n    var s1 = s3 - pp + p;\r\n\r\n    // Layout of keyframe output values for CUBICSPLINE animations:\r\n    //   [ inTangent_1, splineVertex_1, outTangent_1, inTangent_2, splineVertex_2, ... ]\r\n    for (var i = 0; i !== stride; i++) {\r\n      var p0 = values[offset0 + i + stride]; // splineVertex_k\r\n      var m0 = values[offset0 + i + stride2] * td; // outTangent_k * (t_k+1 - t_k)\r\n      var p1 = values[offset1 + i + stride]; // splineVertex_k+1\r\n      var m1 = values[offset1 + i] * td; // inTangent_k+1 * (t_k+1 - t_k)\r\n\r\n      result[i] = s0 * p0 + s1 * m0 + s2 * p1 + s3 * m1;\r\n    }\r\n\r\n    return result;\r\n  };\r\n\r\n  /*********************************/\r\n  /********** INTERNALS ************/\r\n  /*********************************/\r\n\r\n  /* CONSTANTS */\r\n\r\n  var WEBGL_CONSTANTS = {\r\n    FLOAT: 5126,\r\n    //FLOAT_MAT2: 35674,\r\n    FLOAT_MAT3: 35675,\r\n    FLOAT_MAT4: 35676,\r\n    FLOAT_VEC2: 35664,\r\n    FLOAT_VEC3: 35665,\r\n    FLOAT_VEC4: 35666,\r\n    LINEAR: 9729,\r\n    REPEAT: 10497,\r\n    SAMPLER_2D: 35678,\r\n    POINTS: 0,\r\n    LINES: 1,\r\n    LINE_LOOP: 2,\r\n    LINE_STRIP: 3,\r\n    TRIANGLES: 4,\r\n    TRIANGLE_STRIP: 5,\r\n    TRIANGLE_FAN: 6,\r\n    UNSIGNED_BYTE: 5121,\r\n    UNSIGNED_SHORT: 5123,\r\n  };\r\n\r\n  var WEBGL_COMPONENT_TYPES = {\r\n    5120: Int8Array,\r\n    5121: Uint8Array,\r\n    5122: Int16Array,\r\n    5123: Uint16Array,\r\n    5125: Uint32Array,\r\n    5126: Float32Array,\r\n  };\r\n\r\n  var WEBGL_FILTERS = {\r\n    9728: NearestFilter,\r\n    9729: LinearFilter,\r\n    9984: NearestMipmapNearestFilter,\r\n    9985: LinearMipmapNearestFilter,\r\n    9986: NearestMipmapLinearFilter,\r\n    9987: LinearMipmapLinearFilter,\r\n  };\r\n\r\n  var WEBGL_WRAPPINGS = {\r\n    33071: ClampToEdgeWrapping,\r\n    33648: MirroredRepeatWrapping,\r\n    10497: RepeatWrapping,\r\n  };\r\n\r\n  var WEBGL_TYPE_SIZES = {\r\n    SCALAR: 1,\r\n    VEC2: 2,\r\n    VEC3: 3,\r\n    VEC4: 4,\r\n    MAT2: 4,\r\n    MAT3: 9,\r\n    MAT4: 16,\r\n  };\r\n\r\n  var ATTRIBUTES = {\r\n    POSITION: 'position',\r\n    NORMAL: 'normal',\r\n    TANGENT: 'tangent',\r\n    TEXCOORD_0: 'uv',\r\n    TEXCOORD_1: 'uv2',\r\n    COLOR_0: 'color',\r\n    WEIGHTS_0: 'skinWeight',\r\n    JOINTS_0: 'skinIndex',\r\n  };\r\n\r\n  var PATH_PROPERTIES = {\r\n    scale: 'scale',\r\n    translation: 'position',\r\n    rotation: 'quaternion',\r\n    weights: 'morphTargetInfluences',\r\n  };\r\n\r\n  var INTERPOLATION = {\r\n    CUBICSPLINE: undefined, // We use a custom interpolant (GLTFCubicSplineInterpolation) for CUBICSPLINE tracks. Each\r\n    // keyframe track will be initialized with a default interpolation type, then modified.\r\n    LINEAR: InterpolateLinear,\r\n    STEP: InterpolateDiscrete,\r\n  };\r\n\r\n  var ALPHA_MODES = {\r\n    OPAQUE: 'OPAQUE',\r\n    MASK: 'MASK',\r\n    BLEND: 'BLEND',\r\n  };\r\n\r\n  var MIME_TYPE_FORMATS = {\r\n    'image/png': RGBAFormat,\r\n    'image/jpeg': RGBFormat,\r\n  };\r\n\r\n  /* UTILITY FUNCTIONS */\r\n\r\n  function resolveURL(url, path) {\r\n    // Invalid URL\r\n    if (typeof url !== 'string' || url === '') return '';\r\n\r\n    // Host Relative URL\r\n    if (/^https?:\\/\\//i.test(path) && /^\\//.test(url)) {\r\n      // eslint-disable-next-line no-useless-escape\r\n      path = path.replace(/(^https?:\\/\\/[^\\/]+).*/i, '$1');\r\n    }\r\n\r\n    // Absolute URL http://,https://,//\r\n    if (/^(https?:)?\\/\\//i.test(url)) return url;\r\n\r\n    // Data URI\r\n    if (/^data:.*,.*$/i.test(url)) return url;\r\n\r\n    // Blob URL\r\n    if (/^blob:.*$/i.test(url)) return url;\r\n\r\n    // Relative URL\r\n    return path + url;\r\n  }\r\n\r\n  /**\r\n   * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#default-material\r\n   */\r\n  function createDefaultMaterial(cache) {\r\n    if (cache['DefaultMaterial'] === undefined) {\r\n      cache['DefaultMaterial'] = new MeshStandardMaterial({\r\n        color: 0xffffff,\r\n        emissive: 0x000000,\r\n        metalness: 1,\r\n        roughness: 1,\r\n        transparent: false,\r\n        depthTest: true,\r\n        side: FrontSide,\r\n      });\r\n    }\r\n\r\n    return cache['DefaultMaterial'];\r\n  }\r\n\r\n  function addUnknownExtensionsToUserData(knownExtensions, object, objectDef) {\r\n    // Add unknown glTF extensions to an object's userData.\r\n\r\n    for (var name in objectDef.extensions) {\r\n      if (knownExtensions[name] === undefined) {\r\n        object.userData.gltfExtensions = object.userData.gltfExtensions || {};\r\n        object.userData.gltfExtensions[name] = objectDef.extensions[name];\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @param {Object3D|Material|BufferGeometry} object\r\n   * @param {GLTF.definition} gltfDef\r\n   */\r\n  function assignExtrasToUserData(object, gltfDef) {\r\n    if (gltfDef.extras !== undefined) {\r\n      if (typeof gltfDef.extras === 'object') {\r\n        Object.assign(object.userData, gltfDef.extras);\r\n      } else {\r\n        console.warn('THREE.GLTFLoader: Ignoring primitive type .extras, ' + gltfDef.extras);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#morph-targets\r\n   *\r\n   * @param {BufferGeometry} geometry\r\n   * @param {Array<GLTF.Target>} targets\r\n   * @param {GLTFParser} parser\r\n   * @return {Promise<BufferGeometry>}\r\n   */\r\n  function addMorphTargets(geometry, targets, parser) {\r\n    var hasMorphPosition = false;\r\n    var hasMorphNormal = false;\r\n\r\n    for (var i = 0, il = targets.length; i < il; i++) {\r\n      var target = targets[i];\r\n\r\n      if (target.POSITION !== undefined) hasMorphPosition = true;\r\n      if (target.NORMAL !== undefined) hasMorphNormal = true;\r\n\r\n      if (hasMorphPosition && hasMorphNormal) break;\r\n    }\r\n\r\n    if (!hasMorphPosition && !hasMorphNormal) return Promise.resolve(geometry);\r\n\r\n    var pendingPositionAccessors = [];\r\n    var pendingNormalAccessors = [];\r\n\r\n    for (var i = 0, il = targets.length; i < il; i++) {\r\n      var target = targets[i];\r\n\r\n      if (hasMorphPosition) {\r\n        var pendingAccessor =\r\n              target.POSITION !== undefined\r\n                ? parser.getDependency('accessor', target.POSITION)\r\n                : geometry.attributes.position;\r\n\r\n        pendingPositionAccessors.push(pendingAccessor);\r\n      }\r\n\r\n      if (hasMorphNormal) {\r\n        var pendingAccessor =\r\n              target.NORMAL !== undefined\r\n                ? parser.getDependency('accessor', target.NORMAL)\r\n                : geometry.attributes.normal;\r\n\r\n        pendingNormalAccessors.push(pendingAccessor);\r\n      }\r\n    }\r\n\r\n    return Promise.all([\r\n      Promise.all(pendingPositionAccessors),\r\n      Promise.all(pendingNormalAccessors),\r\n    ]).then(function (accessors) {\r\n      var morphPositions = accessors[0];\r\n      var morphNormals = accessors[1];\r\n\r\n      if (hasMorphPosition) geometry.morphAttributes.position = morphPositions;\r\n      if (hasMorphNormal) geometry.morphAttributes.normal = morphNormals;\r\n      geometry.morphTargetsRelative = true;\r\n\r\n      return geometry;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @param {Mesh} mesh\r\n   * @param {GLTF.Mesh} meshDef\r\n   */\r\n  function updateMorphTargets(mesh, meshDef) {\r\n    mesh.updateMorphTargets();\r\n\r\n    if (meshDef.weights !== undefined) {\r\n      for (var i = 0, il = meshDef.weights.length; i < il; i++) {\r\n        mesh.morphTargetInfluences[i] = meshDef.weights[i];\r\n      }\r\n    }\r\n\r\n    // .extras has user-defined data, so check that .extras.targetNames is an array.\r\n    if (meshDef.extras && Array.isArray(meshDef.extras.targetNames)) {\r\n      var targetNames = meshDef.extras.targetNames;\r\n\r\n      if (mesh.morphTargetInfluences.length === targetNames.length) {\r\n        mesh.morphTargetDictionary = {};\r\n\r\n        for (var i = 0, il = targetNames.length; i < il; i++) {\r\n          mesh.morphTargetDictionary[targetNames[i]] = i;\r\n        }\r\n      } else {\r\n        console.warn('THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.');\r\n      }\r\n    }\r\n  }\r\n\r\n  function createPrimitiveKey(primitiveDef) {\r\n    var dracoExtension =\r\n          primitiveDef.extensions && primitiveDef.extensions[EXTENSIONS.KHR_DRACO_MESH_COMPRESSION];\r\n    var geometryKey;\r\n\r\n    if (dracoExtension) {\r\n      geometryKey =\r\n        'draco:' +\r\n        dracoExtension.bufferView +\r\n        ':' +\r\n        dracoExtension.indices +\r\n        ':' +\r\n        createAttributesKey(dracoExtension.attributes);\r\n    } else {\r\n      geometryKey =\r\n        primitiveDef.indices +\r\n        ':' +\r\n        createAttributesKey(primitiveDef.attributes) +\r\n        ':' +\r\n        primitiveDef.mode;\r\n    }\r\n\r\n    return geometryKey;\r\n  }\r\n\r\n  function createAttributesKey(attributes) {\r\n    var attributesKey = '';\r\n\r\n    var keys = Object.keys(attributes).sort();\r\n\r\n    for (var i = 0, il = keys.length; i < il; i++) {\r\n      attributesKey += keys[i] + ':' + attributes[keys[i]] + ';';\r\n    }\r\n\r\n    return attributesKey;\r\n  }\r\n\r\n  /* GLTF PARSER */\r\n\r\n  function GLTFParser(json, extensions, options) {\r\n    this.json = json || {};\r\n    this.extensions = extensions || {};\r\n    this.options = options || {};\r\n\r\n    // loader object cache\r\n    this.cache = new GLTFRegistry();\r\n\r\n    // BufferGeometry caching\r\n    this.primitiveCache = {};\r\n\r\n    this.textureLoader = new TextureLoader(this.options.manager);\r\n    this.textureLoader.setCrossOrigin(this.options.crossOrigin);\r\n\r\n    this.fileLoader = new FileLoader(this.options.manager);\r\n    this.fileLoader.setResponseType('arraybuffer');\r\n\r\n    if (this.options.crossOrigin === 'use-credentials') {\r\n      this.fileLoader.setWithCredentials(true);\r\n    }\r\n  }\r\n\r\n  GLTFParser.prototype.parse = function (onLoad, onError) {\r\n    var parser = this;\r\n    var json = this.json;\r\n    var extensions = this.extensions;\r\n\r\n    // Clear the loader cache\r\n    this.cache.removeAll();\r\n\r\n    // Mark the special nodes/meshes in json for efficient parse\r\n    this.markDefs();\r\n\r\n    Promise.all([\r\n      this.getDependencies('scene'),\r\n      this.getDependencies('animation'),\r\n      this.getDependencies('camera'),\r\n    ])\r\n      .then(function (dependencies) {\r\n        var result = {\r\n          scene: dependencies[0][json.scene || 0],\r\n          scenes: dependencies[0],\r\n          animations: dependencies[1],\r\n          cameras: dependencies[2],\r\n          asset: json.asset,\r\n          parser: parser,\r\n          userData: {},\r\n        };\r\n\r\n        addUnknownExtensionsToUserData(extensions, result, json);\r\n\r\n        assignExtrasToUserData(result, json);\r\n\r\n        onLoad(result);\r\n      })\r\n      .catch(onError);\r\n  };\r\n\r\n  /**\r\n   * Marks the special nodes/meshes in json for efficient parse.\r\n   */\r\n  GLTFParser.prototype.markDefs = function () {\r\n    var nodeDefs = this.json.nodes || [];\r\n    var skinDefs = this.json.skins || [];\r\n    var meshDefs = this.json.meshes || [];\r\n\r\n    var meshReferences = {};\r\n    var meshUses = {};\r\n\r\n    // Nothing in the node definition indicates whether it is a Bone or an\r\n    // Object3D. Use the skins' joint references to mark bones.\r\n    for (var skinIndex = 0, skinLength = skinDefs.length; skinIndex < skinLength; skinIndex++) {\r\n      var joints = skinDefs[skinIndex].joints;\r\n\r\n      for (var i = 0, il = joints.length; i < il; i++) {\r\n        nodeDefs[joints[i]].isBone = true;\r\n      }\r\n    }\r\n\r\n    // Meshes can (and should) be reused by multiple nodes in a glTF asset. To\r\n    // avoid having more than one Mesh with the same name, count\r\n    // references and rename instances below.\r\n    //\r\n    // Example: CesiumMilkTruck sample model reuses \"Wheel\" meshes.\r\n    for (var nodeIndex = 0, nodeLength = nodeDefs.length; nodeIndex < nodeLength; nodeIndex++) {\r\n      var nodeDef = nodeDefs[nodeIndex];\r\n\r\n      if (nodeDef.mesh !== undefined) {\r\n        if (meshReferences[nodeDef.mesh] === undefined) {\r\n          meshReferences[nodeDef.mesh] = meshUses[nodeDef.mesh] = 0;\r\n        }\r\n\r\n        meshReferences[nodeDef.mesh]++;\r\n\r\n        // Nothing in the mesh definition indicates whether it is\r\n        // a SkinnedMesh or Mesh. Use the node's mesh reference\r\n        // to mark SkinnedMesh if node has skin.\r\n        if (nodeDef.skin !== undefined) {\r\n          meshDefs[nodeDef.mesh].isSkinnedMesh = true;\r\n        }\r\n      }\r\n    }\r\n\r\n    this.json.meshReferences = meshReferences;\r\n    this.json.meshUses = meshUses;\r\n  };\r\n\r\n  /**\r\n   * Requests the specified dependency asynchronously, with caching.\r\n   * @param {string} type\r\n   * @param {number} index\r\n   * @return {Promise<Object3D|Material|THREE.Texture|AnimationClip|ArrayBuffer|Object>}\r\n   */\r\n  GLTFParser.prototype.getDependency = function (type, index) {\r\n    var cacheKey = type + ':' + index;\r\n    var dependency = this.cache.get(cacheKey);\r\n\r\n    if (!dependency) {\r\n      switch (type) {\r\n        case 'scene':\r\n          dependency = this.loadScene(index);\r\n          break;\r\n\r\n        case 'node':\r\n          dependency = this.loadNode(index);\r\n          break;\r\n\r\n        case 'mesh':\r\n          dependency = this.loadMesh(index);\r\n          break;\r\n\r\n        case 'accessor':\r\n          dependency = this.loadAccessor(index);\r\n          break;\r\n\r\n        case 'bufferView':\r\n          dependency = this.loadBufferView(index);\r\n          break;\r\n\r\n        case 'buffer':\r\n          dependency = this.loadBuffer(index);\r\n          break;\r\n\r\n        case 'material':\r\n          dependency = this.loadMaterial(index);\r\n          break;\r\n\r\n        case 'texture':\r\n          dependency = this.loadTexture(index);\r\n          break;\r\n\r\n        case 'skin':\r\n          dependency = this.loadSkin(index);\r\n          break;\r\n\r\n        case 'animation':\r\n          dependency = this.loadAnimation(index);\r\n          break;\r\n\r\n        case 'camera':\r\n          dependency = this.loadCamera(index);\r\n          break;\r\n\r\n        case 'light':\r\n          dependency = this.extensions[EXTENSIONS.KHR_LIGHTS_PUNCTUAL].loadLight(index);\r\n          break;\r\n\r\n        default:\r\n          throw new Error('Unknown type: ' + type);\r\n      }\r\n\r\n      this.cache.add(cacheKey, dependency);\r\n    }\r\n\r\n    return dependency;\r\n  };\r\n\r\n  /**\r\n   * Requests all dependencies of the specified type asynchronously, with caching.\r\n   * @param {string} type\r\n   * @return {Promise<Array<Object>>}\r\n   */\r\n  GLTFParser.prototype.getDependencies = function (type) {\r\n    var dependencies = this.cache.get(type);\r\n\r\n    if (!dependencies) {\r\n      var parser = this;\r\n      var defs = this.json[type + (type === 'mesh' ? 'es' : 's')] || [];\r\n\r\n      dependencies = Promise.all(\r\n        defs.map(function (def, index) {\r\n          return parser.getDependency(type, index);\r\n        })\r\n      );\r\n\r\n      this.cache.add(type, dependencies);\r\n    }\r\n\r\n    return dependencies;\r\n  };\r\n\r\n  /**\r\n   * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#buffers-and-buffer-views\r\n   * @param {number} bufferIndex\r\n   * @return {Promise<ArrayBuffer>}\r\n   */\r\n  GLTFParser.prototype.loadBuffer = function (bufferIndex) {\r\n    var bufferDef = this.json.buffers[bufferIndex];\r\n    var loader = this.fileLoader;\r\n\r\n    if (bufferDef.type && bufferDef.type !== 'arraybuffer') {\r\n      throw new Error('THREE.GLTFLoader: ' + bufferDef.type + ' buffer type is not supported.');\r\n    }\r\n\r\n    // If present, GLB container is required to be the first buffer.\r\n    if (bufferDef.uri === undefined && bufferIndex === 0) {\r\n      return Promise.resolve(this.extensions[EXTENSIONS.KHR_BINARY_GLTF].body);\r\n    }\r\n\r\n    var options = this.options;\r\n\r\n    return new Promise(function (resolve, reject) {\r\n      loader.load(resolveURL(bufferDef.uri, options.path), resolve, undefined, function () {\r\n        reject(new Error('THREE.GLTFLoader: Failed to load buffer \"' + bufferDef.uri + '\".'));\r\n      });\r\n    });\r\n  };\r\n\r\n  /**\r\n   * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#buffers-and-buffer-views\r\n   * @param {number} bufferViewIndex\r\n   * @return {Promise<ArrayBuffer>}\r\n   */\r\n  GLTFParser.prototype.loadBufferView = function (bufferViewIndex) {\r\n    var bufferViewDef = this.json.bufferViews[bufferViewIndex];\r\n\r\n    return this.getDependency('buffer', bufferViewDef.buffer).then(function (buffer) {\r\n      var byteLength = bufferViewDef.byteLength || 0;\r\n      var byteOffset = bufferViewDef.byteOffset || 0;\r\n      return buffer.slice(byteOffset, byteOffset + byteLength);\r\n    });\r\n  };\r\n\r\n  /**\r\n   * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#accessors\r\n   * @param {number} accessorIndex\r\n   * @return {Promise<BufferAttribute|InterleavedBufferAttribute>}\r\n   */\r\n  GLTFParser.prototype.loadAccessor = function (accessorIndex) {\r\n    var parser = this;\r\n    var json = this.json;\r\n\r\n    var accessorDef = this.json.accessors[accessorIndex];\r\n\r\n    if (accessorDef.bufferView === undefined && accessorDef.sparse === undefined) {\r\n      // Ignore empty accessors, which may be used to declare runtime\r\n      // information about attributes coming from another source (e.g. Draco\r\n      // compression extension).\r\n      return Promise.resolve(null);\r\n    }\r\n\r\n    var pendingBufferViews = [];\r\n\r\n    if (accessorDef.bufferView !== undefined) {\r\n      pendingBufferViews.push(this.getDependency('bufferView', accessorDef.bufferView));\r\n    } else {\r\n      pendingBufferViews.push(null);\r\n    }\r\n\r\n    if (accessorDef.sparse !== undefined) {\r\n      pendingBufferViews.push(\r\n        this.getDependency('bufferView', accessorDef.sparse.indices.bufferView)\r\n      );\r\n      pendingBufferViews.push(\r\n        this.getDependency('bufferView', accessorDef.sparse.values.bufferView)\r\n      );\r\n    }\r\n\r\n    return Promise.all(pendingBufferViews).then(function (bufferViews) {\r\n      var bufferView = bufferViews[0];\r\n\r\n      var itemSize = WEBGL_TYPE_SIZES[accessorDef.type];\r\n      var TypedArray = WEBGL_COMPONENT_TYPES[accessorDef.componentType];\r\n\r\n      // For VEC3: itemSize is 3, elementBytes is 4, itemBytes is 12.\r\n      var elementBytes = TypedArray.BYTES_PER_ELEMENT;\r\n      var itemBytes = elementBytes * itemSize;\r\n      var byteOffset = accessorDef.byteOffset || 0;\r\n      var byteStride =\r\n            accessorDef.bufferView !== undefined\r\n              ? json.bufferViews[accessorDef.bufferView].byteStride\r\n              : undefined;\r\n      var normalized = accessorDef.normalized === true;\r\n      var array, bufferAttribute;\r\n\r\n      // The buffer is not interleaved if the stride is the item size in bytes.\r\n      if (byteStride && byteStride !== itemBytes) {\r\n        // Each \"slice\" of the buffer, as defined by 'count' elements of 'byteStride' bytes, gets its own InterleavedBuffer\r\n        // This makes sure that IBA.count reflects accessor.count properly\r\n        var ibSlice = Math.floor(byteOffset / byteStride);\r\n        var ibCacheKey =\r\n              'InterleavedBuffer:' +\r\n              accessorDef.bufferView +\r\n              ':' +\r\n              accessorDef.componentType +\r\n              ':' +\r\n              ibSlice +\r\n              ':' +\r\n              accessorDef.count;\r\n        var ib = parser.cache.get(ibCacheKey);\r\n\r\n        if (!ib) {\r\n          array = new TypedArray(\r\n            bufferView,\r\n            ibSlice * byteStride,\r\n            (accessorDef.count * byteStride) / elementBytes\r\n          );\r\n\r\n          // Integer parameters to IB/IBA are in array elements, not bytes.\r\n          ib = new InterleavedBuffer(array, byteStride / elementBytes);\r\n\r\n          parser.cache.add(ibCacheKey, ib);\r\n        }\r\n\r\n        bufferAttribute = new InterleavedBufferAttribute(\r\n          ib,\r\n          itemSize,\r\n          (byteOffset % byteStride) / elementBytes,\r\n          normalized\r\n        );\r\n      } else {\r\n        if (bufferView === null) {\r\n          array = new TypedArray(accessorDef.count * itemSize);\r\n        } else {\r\n          array = new TypedArray(bufferView, byteOffset, accessorDef.count * itemSize);\r\n        }\r\n\r\n        bufferAttribute = new BufferAttribute(array, itemSize, normalized);\r\n      }\r\n\r\n      // https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#sparse-accessors\r\n      if (accessorDef.sparse !== undefined) {\r\n        var itemSizeIndices = WEBGL_TYPE_SIZES.SCALAR;\r\n        var TypedArrayIndices = WEBGL_COMPONENT_TYPES[accessorDef.sparse.indices.componentType];\r\n\r\n        var byteOffsetIndices = accessorDef.sparse.indices.byteOffset || 0;\r\n        var byteOffsetValues = accessorDef.sparse.values.byteOffset || 0;\r\n\r\n        var sparseIndices = new TypedArrayIndices(\r\n          bufferViews[1],\r\n          byteOffsetIndices,\r\n          accessorDef.sparse.count * itemSizeIndices\r\n        );\r\n        var sparseValues = new TypedArray(\r\n          bufferViews[2],\r\n          byteOffsetValues,\r\n          accessorDef.sparse.count * itemSize\r\n        );\r\n\r\n        if (bufferView !== null) {\r\n          // Avoid modifying the original ArrayBuffer, if the bufferView wasn't initialized with zeroes.\r\n          bufferAttribute = new BufferAttribute(\r\n            bufferAttribute.array.slice(),\r\n            bufferAttribute.itemSize,\r\n            bufferAttribute.normalized\r\n          );\r\n        }\r\n\r\n        for (var i = 0, il = sparseIndices.length; i < il; i++) {\r\n          var index = sparseIndices[i];\r\n\r\n          bufferAttribute.setX(index, sparseValues[i * itemSize]);\r\n          if (itemSize >= 2) bufferAttribute.setY(index, sparseValues[i * itemSize + 1]);\r\n          if (itemSize >= 3) bufferAttribute.setZ(index, sparseValues[i * itemSize + 2]);\r\n          if (itemSize >= 4) bufferAttribute.setW(index, sparseValues[i * itemSize + 3]);\r\n          if (itemSize >= 5)\r\n            throw new Error('THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.');\r\n        }\r\n      }\r\n\r\n      return bufferAttribute;\r\n    });\r\n  };\r\n\r\n  /**\r\n   * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#textures\r\n   * @param {number} textureIndex\r\n   * @return {Promise<THREE.Texture>}\r\n   */\r\n  GLTFParser.prototype.loadTexture = function (textureIndex) {\r\n    var parser = this;\r\n    var json = this.json;\r\n    var options = this.options;\r\n    var textureLoader = this.textureLoader;\r\n\r\n    var URL = self.URL || self.webkitURL;\r\n\r\n    var textureDef = json.textures[textureIndex];\r\n\r\n    var textureExtensions = textureDef.extensions || {};\r\n\r\n    var source;\r\n\r\n    if (textureExtensions[EXTENSIONS.MSFT_TEXTURE_DDS]) {\r\n      source = json.images[textureExtensions[EXTENSIONS.MSFT_TEXTURE_DDS].source];\r\n    } else {\r\n      source = json.images[textureDef.source];\r\n    }\r\n\r\n    var sourceURI = source.uri;\r\n    var isObjectURL = false;\r\n\r\n    if (source.bufferView !== undefined) {\r\n      // Load binary image data from bufferView, if provided.\r\n\r\n      sourceURI = parser.getDependency('bufferView', source.bufferView).then(function (bufferView) {\r\n        isObjectURL = true;\r\n        var blob = new Blob([bufferView], { type: source.mimeType });\r\n        sourceURI = URL.createObjectURL(blob);\r\n        return sourceURI;\r\n      });\r\n    }\r\n\r\n    return Promise.resolve(sourceURI)\r\n      .then(function (sourceURI) {\r\n        // Load Texture resource.\r\n\r\n        var loader = options.manager.getHandler(sourceURI);\r\n\r\n        if (!loader) {\r\n          loader = textureExtensions[EXTENSIONS.MSFT_TEXTURE_DDS]\r\n            ? parser.extensions[EXTENSIONS.MSFT_TEXTURE_DDS].ddsLoader\r\n            : textureLoader;\r\n        }\r\n\r\n        return new Promise(function (resolve, reject) {\r\n          loader.load(resolveURL(sourceURI, options.path), resolve, undefined, reject);\r\n        });\r\n      })\r\n      .then(function (texture) {\r\n        // Clean up resources and configure Texture.\r\n\r\n        if (isObjectURL === true) {\r\n          URL.revokeObjectURL(sourceURI);\r\n        }\r\n\r\n        texture.flipY = false;\r\n\r\n        if (textureDef.name) texture.name = textureDef.name;\r\n\r\n        // Ignore unknown mime types, like DDS files.\r\n        if (source.mimeType in MIME_TYPE_FORMATS) {\r\n          texture.format = MIME_TYPE_FORMATS[source.mimeType];\r\n        }\r\n\r\n        var samplers = json.samplers || {};\r\n        var sampler = samplers[textureDef.sampler] || {};\r\n\r\n        texture.magFilter = WEBGL_FILTERS[sampler.magFilter] || LinearFilter;\r\n        texture.minFilter = WEBGL_FILTERS[sampler.minFilter] || LinearMipmapLinearFilter;\r\n        texture.wrapS = WEBGL_WRAPPINGS[sampler.wrapS] || RepeatWrapping;\r\n        texture.wrapT = WEBGL_WRAPPINGS[sampler.wrapT] || RepeatWrapping;\r\n\r\n        return texture;\r\n      });\r\n  };\r\n\r\n  /**\r\n   * Asynchronously assigns a texture to the given material parameters.\r\n   * @param {Object} materialParams\r\n   * @param {string} mapName\r\n   * @param {Object} mapDef\r\n   * @return {Promise}\r\n   */\r\n  GLTFParser.prototype.assignTexture = function (materialParams, mapName, mapDef) {\r\n    var parser = this;\r\n\r\n    return this.getDependency('texture', mapDef.index).then(function (texture) {\r\n      if (!texture.isCompressedTexture) {\r\n        switch (mapName) {\r\n          case 'aoMap':\r\n          case 'emissiveMap':\r\n          case 'metalnessMap':\r\n          case 'normalMap':\r\n          case 'roughnessMap':\r\n            texture.format = RGBFormat;\r\n            break;\r\n        }\r\n      }\r\n\r\n      // Materials sample aoMap from UV set 1 and other maps from UV set 0 - this can't be configured\r\n      // However, we will copy UV set 0 to UV set 1 on demand for aoMap\r\n      if (\r\n        mapDef.texCoord !== undefined &&\r\n        mapDef.texCoord != 0 &&\r\n        !(mapName === 'aoMap' && mapDef.texCoord == 1)\r\n      ) {\r\n        console.warn(\r\n          'THREE.GLTFLoader: Custom UV set ' +\r\n          mapDef.texCoord +\r\n          ' for texture ' +\r\n          mapName +\r\n          ' not yet supported.'\r\n        );\r\n      }\r\n\r\n      if (parser.extensions[EXTENSIONS.KHR_TEXTURE_TRANSFORM]) {\r\n        var transform =\r\n              mapDef.extensions !== undefined\r\n                ? mapDef.extensions[EXTENSIONS.KHR_TEXTURE_TRANSFORM]\r\n                : undefined;\r\n\r\n        if (transform) {\r\n          texture = parser.extensions[EXTENSIONS.KHR_TEXTURE_TRANSFORM].extendTexture(\r\n            texture,\r\n            transform\r\n          );\r\n        }\r\n      }\r\n\r\n      materialParams[mapName] = texture;\r\n    });\r\n  };\r\n\r\n  /**\r\n   * Assigns final material to a Mesh, Line, or Points instance. The instance\r\n   * already has a material (generated from the glTF material options alone)\r\n   * but reuse of the same glTF material may require multiple threejs materials\r\n   * to accomodate different primitive types, defines, etc. New materials will\r\n   * be created if necessary, and reused from a cache.\r\n   * @param  {Object3D} mesh Mesh, Line, or Points instance.\r\n   */\r\n  GLTFParser.prototype.assignFinalMaterial = function (mesh) {\r\n    var geometry = mesh.geometry;\r\n    var material = mesh.material;\r\n\r\n    var useVertexTangents = geometry.attributes.tangent !== undefined;\r\n    var useVertexColors = geometry.attributes.color !== undefined;\r\n    var useFlatShading = geometry.attributes.normal === undefined;\r\n    var useSkinning = mesh.isSkinnedMesh === true;\r\n    var useMorphTargets = Object.keys(geometry.morphAttributes).length > 0;\r\n    var useMorphNormals = useMorphTargets && geometry.morphAttributes.normal !== undefined;\r\n\r\n    if (mesh.isPoints) {\r\n      var cacheKey = 'PointsMaterial:' + material.uuid;\r\n\r\n      var pointsMaterial = this.cache.get(cacheKey);\r\n\r\n      if (!pointsMaterial) {\r\n        pointsMaterial = new PointsMaterial();\r\n        Material.prototype.copy.call(pointsMaterial, material);\r\n        pointsMaterial.color.copy(material.color);\r\n        pointsMaterial.map = material.map;\r\n        pointsMaterial.sizeAttenuation = false; // glTF spec says points should be 1px\r\n\r\n        this.cache.add(cacheKey, pointsMaterial);\r\n      }\r\n\r\n      material = pointsMaterial;\r\n    } else if (mesh.isLine) {\r\n      var cacheKey = 'LineBasicMaterial:' + material.uuid;\r\n\r\n      var lineMaterial = this.cache.get(cacheKey);\r\n\r\n      if (!lineMaterial) {\r\n        lineMaterial = new LineBasicMaterial();\r\n        Material.prototype.copy.call(lineMaterial, material);\r\n        lineMaterial.color.copy(material.color);\r\n\r\n        this.cache.add(cacheKey, lineMaterial);\r\n      }\r\n\r\n      material = lineMaterial;\r\n    }\r\n\r\n    // Clone the material if it will be modified\r\n    if (useVertexTangents || useVertexColors || useFlatShading || useSkinning || useMorphTargets) {\r\n      var cacheKey = 'ClonedMaterial:' + material.uuid + ':';\r\n\r\n      if (material.isGLTFSpecularGlossinessMaterial) cacheKey += 'specular-glossiness:';\r\n      if (useSkinning) cacheKey += 'skinning:';\r\n      if (useVertexTangents) cacheKey += 'vertex-tangents:';\r\n      if (useVertexColors) cacheKey += 'vertex-colors:';\r\n      if (useFlatShading) cacheKey += 'flat-shading:';\r\n      if (useMorphTargets) cacheKey += 'morph-targets:';\r\n      if (useMorphNormals) cacheKey += 'morph-normals:';\r\n\r\n      var cachedMaterial = this.cache.get(cacheKey);\r\n\r\n      if (!cachedMaterial) {\r\n        cachedMaterial = material.clone();\r\n\r\n        if (useSkinning) cachedMaterial.skinning = true;\r\n        if (useVertexTangents) cachedMaterial.vertexTangents = true;\r\n        if (useVertexColors) cachedMaterial.vertexColors = true;\r\n        if (useFlatShading) cachedMaterial.flatShading = true;\r\n        if (useMorphTargets) cachedMaterial.morphTargets = true;\r\n        if (useMorphNormals) cachedMaterial.morphNormals = true;\r\n\r\n        this.cache.add(cacheKey, cachedMaterial);\r\n      }\r\n\r\n      material = cachedMaterial;\r\n    }\r\n\r\n    // workarounds for mesh and geometry\r\n\r\n    if (\r\n      material.aoMap &&\r\n      geometry.attributes.uv2 === undefined &&\r\n      geometry.attributes.uv !== undefined\r\n    ) {\r\n      geometry.setAttribute('uv2', geometry.attributes.uv);\r\n    }\r\n\r\n    // https://github.com/mrdoob/three.js/issues/11438#issuecomment-507003995\r\n    if (material.normalScale && !useVertexTangents) {\r\n      material.normalScale.y = -material.normalScale.y;\r\n    }\r\n\r\n    if (material.clearcoatNormalScale && !useVertexTangents) {\r\n      material.clearcoatNormalScale.y = -material.clearcoatNormalScale.y;\r\n    }\r\n\r\n    mesh.material = material;\r\n  };\r\n\r\n  /**\r\n   * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#materials\r\n   * @param {number} materialIndex\r\n   * @return {Promise<Material>}\r\n   */\r\n  GLTFParser.prototype.loadMaterial = function (materialIndex) {\r\n    var parser = this;\r\n    var json = this.json;\r\n    var extensions = this.extensions;\r\n    var materialDef = json.materials[materialIndex];\r\n\r\n    var materialType;\r\n    var materialParams = {};\r\n    var materialExtensions = materialDef.extensions || {};\r\n\r\n    var pending = [];\r\n\r\n    if (materialExtensions[EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]) {\r\n      var sgExtension = extensions[EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];\r\n      materialType = sgExtension.getMaterialType();\r\n      pending.push(sgExtension.extendParams(materialParams, materialDef, parser));\r\n    } else if (materialExtensions[EXTENSIONS.KHR_MATERIALS_UNLIT]) {\r\n      var kmuExtension = extensions[EXTENSIONS.KHR_MATERIALS_UNLIT];\r\n      materialType = kmuExtension.getMaterialType();\r\n      pending.push(kmuExtension.extendParams(materialParams, materialDef, parser));\r\n    } else {\r\n      // Specification:\r\n      // https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#metallic-roughness-material\r\n\r\n      materialType = MeshStandardMaterial;\r\n\r\n      var metallicRoughness = materialDef.pbrMetallicRoughness || {};\r\n\r\n      materialParams.color = new Color(1.0, 1.0, 1.0);\r\n      materialParams.opacity = 1.0;\r\n\r\n      if (Array.isArray(metallicRoughness.baseColorFactor)) {\r\n        var array = metallicRoughness.baseColorFactor;\r\n\r\n        materialParams.color.fromArray(array);\r\n        materialParams.opacity = array[3];\r\n      }\r\n\r\n      if (metallicRoughness.baseColorTexture !== undefined) {\r\n        pending.push(\r\n          parser.assignTexture(materialParams, 'map', metallicRoughness.baseColorTexture)\r\n        );\r\n      }\r\n\r\n      materialParams.metalness =\r\n        metallicRoughness.metallicFactor !== undefined ? metallicRoughness.metallicFactor : 1.0;\r\n      materialParams.roughness =\r\n        metallicRoughness.roughnessFactor !== undefined ? metallicRoughness.roughnessFactor : 1.0;\r\n\r\n      if (metallicRoughness.metallicRoughnessTexture !== undefined) {\r\n        pending.push(\r\n          parser.assignTexture(\r\n            materialParams,\r\n            'metalnessMap',\r\n            metallicRoughness.metallicRoughnessTexture\r\n          )\r\n        );\r\n        pending.push(\r\n          parser.assignTexture(\r\n            materialParams,\r\n            'roughnessMap',\r\n            metallicRoughness.metallicRoughnessTexture\r\n          )\r\n        );\r\n      }\r\n    }\r\n\r\n    if (materialDef.doubleSided === true) {\r\n      materialParams.side = DoubleSide;\r\n    }\r\n\r\n    var alphaMode = materialDef.alphaMode || ALPHA_MODES.OPAQUE;\r\n\r\n    if (alphaMode === ALPHA_MODES.BLEND) {\r\n      materialParams.transparent = true;\r\n\r\n      // See: https://github.com/mrdoob/three.js/issues/17706\r\n      materialParams.depthWrite = false;\r\n    } else {\r\n      materialParams.transparent = false;\r\n\r\n      if (alphaMode === ALPHA_MODES.MASK) {\r\n        materialParams.alphaTest =\r\n          materialDef.alphaCutoff !== undefined ? materialDef.alphaCutoff : 0.5;\r\n      }\r\n    }\r\n\r\n    if (materialDef.normalTexture !== undefined && materialType !== MeshBasicMaterial) {\r\n      pending.push(parser.assignTexture(materialParams, 'normalMap', materialDef.normalTexture));\r\n\r\n      materialParams.normalScale = new Vector2(1, 1);\r\n\r\n      if (materialDef.normalTexture.scale !== undefined) {\r\n        materialParams.normalScale.set(\r\n          materialDef.normalTexture.scale,\r\n          materialDef.normalTexture.scale\r\n        );\r\n      }\r\n    }\r\n\r\n    if (materialDef.occlusionTexture !== undefined && materialType !== MeshBasicMaterial) {\r\n      pending.push(parser.assignTexture(materialParams, 'aoMap', materialDef.occlusionTexture));\r\n\r\n      if (materialDef.occlusionTexture.strength !== undefined) {\r\n        materialParams.aoMapIntensity = materialDef.occlusionTexture.strength;\r\n      }\r\n    }\r\n\r\n    if (materialDef.emissiveFactor !== undefined && materialType !== MeshBasicMaterial) {\r\n      materialParams.emissive = new Color().fromArray(materialDef.emissiveFactor);\r\n    }\r\n\r\n    if (materialDef.emissiveTexture !== undefined && materialType !== MeshBasicMaterial) {\r\n      pending.push(\r\n        parser.assignTexture(materialParams, 'emissiveMap', materialDef.emissiveTexture)\r\n      );\r\n    }\r\n\r\n    if (materialExtensions[EXTENSIONS.KHR_MATERIALS_CLEARCOAT]) {\r\n      var clearcoatExtension = extensions[EXTENSIONS.KHR_MATERIALS_CLEARCOAT];\r\n      materialType = clearcoatExtension.getMaterialType();\r\n      pending.push(\r\n        clearcoatExtension.extendParams(materialParams, { extensions: materialExtensions }, parser)\r\n      );\r\n    }\r\n\r\n    return Promise.all(pending).then(function () {\r\n      var material;\r\n\r\n      if (materialType === GLTFMeshStandardSGMaterial) {\r\n        material = extensions[EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(\r\n          materialParams\r\n        );\r\n      } else {\r\n        material = new materialType(materialParams);\r\n      }\r\n\r\n      if (materialDef.name) material.name = materialDef.name;\r\n\r\n      // baseColorTexture, emissiveTexture, and specularGlossinessTexture use sRGB encoding.\r\n      if (material.map) material.map.encoding = sRGBEncoding;\r\n      if (material.emissiveMap) material.emissiveMap.encoding = sRGBEncoding;\r\n\r\n      assignExtrasToUserData(material, materialDef);\r\n\r\n      if (materialDef.extensions) addUnknownExtensionsToUserData(extensions, material, materialDef);\r\n\r\n      return material;\r\n    });\r\n  };\r\n\r\n  /**\r\n   * @param {BufferGeometry} geometry\r\n   * @param {GLTF.Primitive} primitiveDef\r\n   * @param {GLTFParser} parser\r\n   */\r\n  function computeBounds(geometry, primitiveDef, parser) {\r\n    var attributes = primitiveDef.attributes;\r\n\r\n    var box = new Box3();\r\n\r\n    if (attributes.POSITION !== undefined) {\r\n      var accessor = parser.json.accessors[attributes.POSITION];\r\n\r\n      var min = accessor.min;\r\n      var max = accessor.max;\r\n\r\n      // glTF requires 'min' and 'max', but VRM (which extends glTF) currently ignores that requirement.\r\n\r\n      if (min !== undefined && max !== undefined) {\r\n        box.set(new Vector3(min[0], min[1], min[2]), new Vector3(max[0], max[1], max[2]));\r\n      } else {\r\n        console.warn('THREE.GLTFLoader: Missing min/max properties for accessor POSITION.');\r\n\r\n        return;\r\n      }\r\n    } else {\r\n      return;\r\n    }\r\n\r\n    var targets = primitiveDef.targets;\r\n\r\n    if (targets !== undefined) {\r\n      var maxDisplacement = new Vector3();\r\n      var vector = new Vector3();\r\n\r\n      for (var i = 0, il = targets.length; i < il; i++) {\r\n        var target = targets[i];\r\n\r\n        if (target.POSITION !== undefined) {\r\n          var accessor = parser.json.accessors[target.POSITION];\r\n          var min = accessor.min;\r\n          var max = accessor.max;\r\n\r\n          // glTF requires 'min' and 'max', but VRM (which extends glTF) currently ignores that requirement.\r\n\r\n          if (min !== undefined && max !== undefined) {\r\n            // we need to get max of absolute components because target weight is [-1,1]\r\n            vector.setX(Math.max(Math.abs(min[0]), Math.abs(max[0])));\r\n            vector.setY(Math.max(Math.abs(min[1]), Math.abs(max[1])));\r\n            vector.setZ(Math.max(Math.abs(min[2]), Math.abs(max[2])));\r\n\r\n            // Note: this assumes that the sum of all weights is at most 1. This isn't quite correct - it's more conservative\r\n            // to assume that each target can have a max weight of 1. However, for some use cases - notably, when morph targets\r\n            // are used to implement key-frame animations and as such only two are active at a time - this results in very large\r\n            // boxes. So for now we make a box that's sometimes a touch too small but is hopefully mostly of reasonable size.\r\n            maxDisplacement.max(vector);\r\n          } else {\r\n            console.warn('THREE.GLTFLoader: Missing min/max properties for accessor POSITION.');\r\n          }\r\n        }\r\n      }\r\n\r\n      // As per comment above this box isn't conservative, but has a reasonable size for a very large number of morph targets.\r\n      box.expandByVector(maxDisplacement);\r\n    }\r\n\r\n    geometry.boundingBox = box;\r\n\r\n    var sphere = new Sphere();\r\n\r\n    box.getCenter(sphere.center);\r\n    sphere.radius = box.min.distanceTo(box.max) / 2;\r\n\r\n    geometry.boundingSphere = sphere;\r\n  }\r\n\r\n  /**\r\n   * @param {BufferGeometry} geometry\r\n   * @param {GLTF.Primitive} primitiveDef\r\n   * @param {GLTFParser} parser\r\n   * @return {Promise<BufferGeometry>}\r\n   */\r\n  function addPrimitiveAttributes(geometry, primitiveDef, parser) {\r\n    var attributes = primitiveDef.attributes;\r\n\r\n    var pending = [];\r\n\r\n    function assignAttributeAccessor(accessorIndex, attributeName) {\r\n      return parser.getDependency('accessor', accessorIndex).then(function (accessor) {\r\n        geometry.setAttribute(attributeName, accessor);\r\n      });\r\n    }\r\n\r\n    for (var gltfAttributeName in attributes) {\r\n      var threeAttributeName = ATTRIBUTES[gltfAttributeName] || gltfAttributeName.toLowerCase();\r\n\r\n      // Skip attributes already provided by e.g. Draco extension.\r\n      if (threeAttributeName in geometry.attributes) continue;\r\n\r\n      pending.push(assignAttributeAccessor(attributes[gltfAttributeName], threeAttributeName));\r\n    }\r\n\r\n    if (primitiveDef.indices !== undefined && !geometry.index) {\r\n      var accessor = parser\r\n        .getDependency('accessor', primitiveDef.indices)\r\n        .then(function (accessor) {\r\n          geometry.setIndex(accessor);\r\n        });\r\n\r\n      pending.push(accessor);\r\n    }\r\n\r\n    assignExtrasToUserData(geometry, primitiveDef);\r\n\r\n    computeBounds(geometry, primitiveDef, parser);\r\n\r\n    return Promise.all(pending).then(function () {\r\n      return primitiveDef.targets !== undefined\r\n        ? addMorphTargets(geometry, primitiveDef.targets, parser)\r\n        : geometry;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @param {BufferGeometry} geometry\r\n   * @param {Number} drawMode\r\n   * @return {BufferGeometry}\r\n   */\r\n  function toTrianglesDrawMode(geometry, drawMode) {\r\n    var index = geometry.getIndex();\r\n\r\n    // generate index if not present\r\n\r\n    if (index === null) {\r\n      var indices = [];\r\n\r\n      var position = geometry.getAttribute('position');\r\n\r\n      if (position !== undefined) {\r\n        for (var i = 0; i < position.count; i++) {\r\n          indices.push(i);\r\n        }\r\n\r\n        geometry.setIndex(indices);\r\n        index = geometry.getIndex();\r\n      } else {\r\n        console.error(\r\n          'THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible.'\r\n        );\r\n        return geometry;\r\n      }\r\n    }\r\n\r\n    //\r\n\r\n    var numberOfTriangles = index.count - 2;\r\n    var newIndices = [];\r\n\r\n    if (drawMode === TriangleFanDrawMode) {\r\n      // gl.TRIANGLE_FAN\r\n\r\n      for (var i = 1; i <= numberOfTriangles; i++) {\r\n        newIndices.push(index.getX(0));\r\n        newIndices.push(index.getX(i));\r\n        newIndices.push(index.getX(i + 1));\r\n      }\r\n    } else {\r\n      // gl.TRIANGLE_STRIP\r\n\r\n      for (var i = 0; i < numberOfTriangles; i++) {\r\n        if (i % 2 === 0) {\r\n          newIndices.push(index.getX(i));\r\n          newIndices.push(index.getX(i + 1));\r\n          newIndices.push(index.getX(i + 2));\r\n        } else {\r\n          newIndices.push(index.getX(i + 2));\r\n          newIndices.push(index.getX(i + 1));\r\n          newIndices.push(index.getX(i));\r\n        }\r\n      }\r\n    }\r\n\r\n    if (newIndices.length / 3 !== numberOfTriangles) {\r\n      console.error(\r\n        'THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.'\r\n      );\r\n    }\r\n\r\n    // build final geometry\r\n\r\n    var newGeometry = geometry.clone();\r\n    newGeometry.setIndex(newIndices);\r\n\r\n    return newGeometry;\r\n  }\r\n\r\n  /**\r\n   * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#geometry\r\n   *\r\n   * Creates BufferGeometries from primitives.\r\n   *\r\n   * @param {Array<GLTF.Primitive>} primitives\r\n   * @return {Promise<Array<BufferGeometry>>}\r\n   */\r\n  GLTFParser.prototype.loadGeometries = function (primitives) {\r\n    var parser = this;\r\n    var extensions = this.extensions;\r\n    var cache = this.primitiveCache;\r\n\r\n    function createDracoPrimitive(primitive) {\r\n      return extensions[EXTENSIONS.KHR_DRACO_MESH_COMPRESSION]\r\n        .decodePrimitive(primitive, parser)\r\n        .then(function (geometry) {\r\n          return addPrimitiveAttributes(geometry, primitive, parser);\r\n        });\r\n    }\r\n\r\n    var pending = [];\r\n\r\n    for (var i = 0, il = primitives.length; i < il; i++) {\r\n      var primitive = primitives[i];\r\n      var cacheKey = createPrimitiveKey(primitive);\r\n\r\n      // See if we've already created this geometry\r\n      var cached = cache[cacheKey];\r\n\r\n      if (cached) {\r\n        // Use the cached geometry if it exists\r\n        pending.push(cached.promise);\r\n      } else {\r\n        var geometryPromise;\r\n\r\n        if (primitive.extensions && primitive.extensions[EXTENSIONS.KHR_DRACO_MESH_COMPRESSION]) {\r\n          // Use DRACO geometry if available\r\n          geometryPromise = createDracoPrimitive(primitive);\r\n        } else {\r\n          // Otherwise create a new geometry\r\n          geometryPromise = addPrimitiveAttributes(new BufferGeometry(), primitive, parser);\r\n        }\r\n\r\n        // Cache this geometry\r\n        cache[cacheKey] = { primitive: primitive, promise: geometryPromise };\r\n\r\n        pending.push(geometryPromise);\r\n      }\r\n    }\r\n\r\n    return Promise.all(pending);\r\n  };\r\n\r\n  /**\r\n   * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#meshes\r\n   * @param {number} meshIndex\r\n   * @return {Promise<Group|Mesh|SkinnedMesh>}\r\n   */\r\n  GLTFParser.prototype.loadMesh = function (meshIndex) {\r\n    var parser = this;\r\n    var json = this.json;\r\n\r\n    var meshDef = json.meshes[meshIndex];\r\n    var primitives = meshDef.primitives;\r\n\r\n    var pending = [];\r\n\r\n    for (var i = 0, il = primitives.length; i < il; i++) {\r\n      var material =\r\n            primitives[i].material === undefined\r\n              ? createDefaultMaterial(this.cache)\r\n              : this.getDependency('material', primitives[i].material);\r\n\r\n      pending.push(material);\r\n    }\r\n\r\n    pending.push(parser.loadGeometries(primitives));\r\n\r\n    return Promise.all(pending).then(function (results) {\r\n      var materials = results.slice(0, results.length - 1);\r\n      var geometries = results[results.length - 1];\r\n\r\n      var meshes = [];\r\n\r\n      for (var i = 0, il = geometries.length; i < il; i++) {\r\n        var geometry = geometries[i];\r\n        var primitive = primitives[i];\r\n\r\n        // 1. create Mesh\r\n\r\n        var mesh;\r\n\r\n        var material = materials[i];\r\n\r\n        if (\r\n          primitive.mode === WEBGL_CONSTANTS.TRIANGLES ||\r\n          primitive.mode === WEBGL_CONSTANTS.TRIANGLE_STRIP ||\r\n          primitive.mode === WEBGL_CONSTANTS.TRIANGLE_FAN ||\r\n          primitive.mode === undefined\r\n        ) {\r\n          // .isSkinnedMesh isn't in glTF spec. See .markDefs()\r\n          mesh =\r\n            meshDef.isSkinnedMesh === true\r\n              ? new SkinnedMesh(geometry, material)\r\n              : new Mesh(geometry, material);\r\n\r\n          if (mesh.isSkinnedMesh === true && !mesh.geometry.attributes.skinWeight.normalized) {\r\n            // we normalize floating point skin weight array to fix malformed assets (see #15319)\r\n            // it's important to skip this for non-float32 data since normalizeSkinWeights assumes non-normalized inputs\r\n            mesh.normalizeSkinWeights();\r\n          }\r\n\r\n          if (primitive.mode === WEBGL_CONSTANTS.TRIANGLE_STRIP) {\r\n            mesh.geometry = toTrianglesDrawMode(mesh.geometry, TriangleStripDrawMode);\r\n          } else if (primitive.mode === WEBGL_CONSTANTS.TRIANGLE_FAN) {\r\n            mesh.geometry = toTrianglesDrawMode(mesh.geometry, TriangleFanDrawMode);\r\n          }\r\n        } else if (primitive.mode === WEBGL_CONSTANTS.LINES) {\r\n          mesh = new LineSegments(geometry, material);\r\n        } else if (primitive.mode === WEBGL_CONSTANTS.LINE_STRIP) {\r\n          mesh = new Line(geometry, material);\r\n        } else if (primitive.mode === WEBGL_CONSTANTS.LINE_LOOP) {\r\n          mesh = new LineLoop(geometry, material);\r\n        } else if (primitive.mode === WEBGL_CONSTANTS.POINTS) {\r\n          mesh = new Points(geometry, material);\r\n        } else {\r\n          throw new Error('THREE.GLTFLoader: Primitive mode unsupported: ' + primitive.mode);\r\n        }\r\n\r\n        if (Object.keys(mesh.geometry.morphAttributes).length > 0) {\r\n          updateMorphTargets(mesh, meshDef);\r\n        }\r\n\r\n        mesh.name = meshDef.name || 'mesh_' + meshIndex;\r\n\r\n        if (geometries.length > 1) mesh.name += '_' + i;\r\n\r\n        assignExtrasToUserData(mesh, meshDef);\r\n\r\n        parser.assignFinalMaterial(mesh);\r\n\r\n        meshes.push(mesh);\r\n      }\r\n\r\n      if (meshes.length === 1) {\r\n        return meshes[0];\r\n      }\r\n\r\n      var group = new Group();\r\n\r\n      for (var i = 0, il = meshes.length; i < il; i++) {\r\n        group.add(meshes[i]);\r\n      }\r\n\r\n      return group;\r\n    });\r\n  };\r\n\r\n  /**\r\n   * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#cameras\r\n   * @param {number} cameraIndex\r\n   * @return {Promise<THREE.Camera>}\r\n   */\r\n  GLTFParser.prototype.loadCamera = function (cameraIndex) {\r\n    var camera;\r\n    var cameraDef = this.json.cameras[cameraIndex];\r\n    var params = cameraDef[cameraDef.type];\r\n\r\n    if (!params) {\r\n      console.warn('THREE.GLTFLoader: Missing camera parameters.');\r\n      return;\r\n    }\r\n\r\n    if (cameraDef.type === 'perspective') {\r\n      camera = new PerspectiveCamera(\r\n        MathUtils.radToDeg(params.yfov),\r\n        params.aspectRatio || 1,\r\n        params.znear || 1,\r\n        params.zfar || 2e6\r\n      );\r\n    } else if (cameraDef.type === 'orthographic') {\r\n      camera = new OrthographicCamera(\r\n        -params.xmag,\r\n        params.xmag,\r\n        params.ymag,\r\n        -params.ymag,\r\n        params.znear,\r\n        params.zfar\r\n      );\r\n    }\r\n\r\n    if (cameraDef.name) camera.name = cameraDef.name;\r\n\r\n    assignExtrasToUserData(camera, cameraDef);\r\n\r\n    return Promise.resolve(camera);\r\n  };\r\n\r\n  /**\r\n   * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#skins\r\n   * @param {number} skinIndex\r\n   * @return {Promise<Object>}\r\n   */\r\n  GLTFParser.prototype.loadSkin = function (skinIndex) {\r\n    var skinDef = this.json.skins[skinIndex];\r\n\r\n    var skinEntry = { joints: skinDef.joints };\r\n\r\n    if (skinDef.inverseBindMatrices === undefined) {\r\n      return Promise.resolve(skinEntry);\r\n    }\r\n\r\n    return this.getDependency('accessor', skinDef.inverseBindMatrices).then(function (accessor) {\r\n      skinEntry.inverseBindMatrices = accessor;\r\n\r\n      return skinEntry;\r\n    });\r\n  };\r\n\r\n  /**\r\n   * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#animations\r\n   * @param {number} animationIndex\r\n   * @return {Promise<AnimationClip>}\r\n   */\r\n  GLTFParser.prototype.loadAnimation = function (animationIndex) {\r\n    var json = this.json;\r\n\r\n    var animationDef = json.animations[animationIndex];\r\n\r\n    var pendingNodes = [];\r\n    var pendingInputAccessors = [];\r\n    var pendingOutputAccessors = [];\r\n    var pendingSamplers = [];\r\n    var pendingTargets = [];\r\n\r\n    for (var i = 0, il = animationDef.channels.length; i < il; i++) {\r\n      var channel = animationDef.channels[i];\r\n      var sampler = animationDef.samplers[channel.sampler];\r\n      var target = channel.target;\r\n      var name = target.node !== undefined ? target.node : target.id; // NOTE: target.id is deprecated.\r\n      var input =\r\n            animationDef.parameters !== undefined\r\n              ? animationDef.parameters[sampler.input]\r\n              : sampler.input;\r\n      var output =\r\n            animationDef.parameters !== undefined\r\n              ? animationDef.parameters[sampler.output]\r\n              : sampler.output;\r\n\r\n      pendingNodes.push(this.getDependency('node', name));\r\n      pendingInputAccessors.push(this.getDependency('accessor', input));\r\n      pendingOutputAccessors.push(this.getDependency('accessor', output));\r\n      pendingSamplers.push(sampler);\r\n      pendingTargets.push(target);\r\n    }\r\n\r\n    return Promise.all([\r\n      Promise.all(pendingNodes),\r\n      Promise.all(pendingInputAccessors),\r\n      Promise.all(pendingOutputAccessors),\r\n      Promise.all(pendingSamplers),\r\n      Promise.all(pendingTargets),\r\n    ]).then(function (dependencies) {\r\n      var nodes = dependencies[0];\r\n      var inputAccessors = dependencies[1];\r\n      var outputAccessors = dependencies[2];\r\n      var samplers = dependencies[3];\r\n      var targets = dependencies[4];\r\n\r\n      var tracks = [];\r\n\r\n      for (var i = 0, il = nodes.length; i < il; i++) {\r\n        var node = nodes[i];\r\n        var inputAccessor = inputAccessors[i];\r\n        var outputAccessor = outputAccessors[i];\r\n        var sampler = samplers[i];\r\n        var target = targets[i];\r\n\r\n        if (node === undefined) continue;\r\n\r\n        node.updateMatrix();\r\n        node.matrixAutoUpdate = true;\r\n\r\n        var TypedKeyframeTrack;\r\n\r\n        switch (PATH_PROPERTIES[target.path]) {\r\n          case PATH_PROPERTIES.weights:\r\n            TypedKeyframeTrack = NumberKeyframeTrack;\r\n            break;\r\n\r\n          case PATH_PROPERTIES.rotation:\r\n            TypedKeyframeTrack = QuaternionKeyframeTrack;\r\n            break;\r\n\r\n          case PATH_PROPERTIES.position:\r\n          case PATH_PROPERTIES.scale:\r\n          default:\r\n            TypedKeyframeTrack = VectorKeyframeTrack;\r\n            break;\r\n        }\r\n\r\n        var targetName = node.name ? node.name : node.uuid;\r\n\r\n        var interpolation =\r\n              sampler.interpolation !== undefined\r\n                ? INTERPOLATION[sampler.interpolation]\r\n                : InterpolateLinear;\r\n\r\n        var targetNames = [];\r\n\r\n        if (PATH_PROPERTIES[target.path] === PATH_PROPERTIES.weights) {\r\n          // Node may be a Group (glTF mesh with several primitives) or a Mesh.\r\n          node.traverse(function (object) {\r\n            if (object.isMesh === true && object.morphTargetInfluences) {\r\n              targetNames.push(object.name ? object.name : object.uuid);\r\n            }\r\n          });\r\n        } else {\r\n          targetNames.push(targetName);\r\n        }\r\n\r\n        var outputArray = outputAccessor.array;\r\n\r\n        if (outputAccessor.normalized) {\r\n          var scale;\r\n\r\n          if (outputArray.constructor === Int8Array) {\r\n            scale = 1 / 127;\r\n          } else if (outputArray.constructor === Uint8Array) {\r\n            scale = 1 / 255;\r\n          } else if (outputArray.constructor == Int16Array) {\r\n            scale = 1 / 32767;\r\n          } else if (outputArray.constructor === Uint16Array) {\r\n            scale = 1 / 65535;\r\n          } else {\r\n            throw new Error('THREE.GLTFLoader: Unsupported output accessor component type.');\r\n          }\r\n\r\n          var scaled = new Float32Array(outputArray.length);\r\n\r\n          for (var j = 0, jl = outputArray.length; j < jl; j++) {\r\n            scaled[j] = outputArray[j] * scale;\r\n          }\r\n\r\n          outputArray = scaled;\r\n        }\r\n\r\n        for (var j = 0, jl = targetNames.length; j < jl; j++) {\r\n          var track = new TypedKeyframeTrack(\r\n            targetNames[j] + '.' + PATH_PROPERTIES[target.path],\r\n            inputAccessor.array,\r\n            outputArray,\r\n            interpolation\r\n          );\r\n\r\n          // Override interpolation with custom factory method.\r\n          if (sampler.interpolation === 'CUBICSPLINE') {\r\n            track.createInterpolant = function InterpolantFactoryMethodGLTFCubicSpline(result) {\r\n              // A CUBICSPLINE keyframe in glTF has three output values for each input value,\r\n              // representing inTangent, splineVertex, and outTangent. As a result, track.getValueSize()\r\n              // must be divided by three to get the interpolant's sampleSize argument.\r\n\r\n              return new GLTFCubicSplineInterpolant(\r\n                this.times,\r\n                this.values,\r\n                this.getValueSize() / 3,\r\n                result\r\n              );\r\n            };\r\n\r\n            // Mark as CUBICSPLINE. `track.getInterpolation()` doesn't support custom interpolants.\r\n            track.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline = true;\r\n          }\r\n\r\n          tracks.push(track);\r\n        }\r\n      }\r\n\r\n      var name = animationDef.name ? animationDef.name : 'animation_' + animationIndex;\r\n\r\n      return new AnimationClip(name, undefined, tracks);\r\n    });\r\n  };\r\n\r\n  /**\r\n   * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#nodes-and-hierarchy\r\n   * @param {number} nodeIndex\r\n   * @return {Promise<Object3D>}\r\n   */\r\n  GLTFParser.prototype.loadNode = function (nodeIndex) {\r\n    var json = this.json;\r\n    var extensions = this.extensions;\r\n    var parser = this;\r\n\r\n    var meshReferences = json.meshReferences;\r\n    var meshUses = json.meshUses;\r\n\r\n    var nodeDef = json.nodes[nodeIndex];\r\n\r\n    return (function () {\r\n      var pending = [];\r\n\r\n      if (nodeDef.mesh !== undefined) {\r\n        pending.push(\r\n          parser.getDependency('mesh', nodeDef.mesh).then(function (mesh) {\r\n            var node;\r\n\r\n            if (meshReferences[nodeDef.mesh] > 1) {\r\n              var instanceNum = meshUses[nodeDef.mesh]++;\r\n\r\n              node = mesh.clone();\r\n              node.name += '_instance_' + instanceNum;\r\n            } else {\r\n              node = mesh;\r\n            }\r\n\r\n            // if weights are provided on the node, override weights on the mesh.\r\n            if (nodeDef.weights !== undefined) {\r\n              node.traverse(function (o) {\r\n                if (!o.isMesh) return;\r\n\r\n                for (var i = 0, il = nodeDef.weights.length; i < il; i++) {\r\n                  o.morphTargetInfluences[i] = nodeDef.weights[i];\r\n                }\r\n              });\r\n            }\r\n\r\n            return node;\r\n          })\r\n        );\r\n      }\r\n\r\n      if (nodeDef.camera !== undefined) {\r\n        pending.push(parser.getDependency('camera', nodeDef.camera));\r\n      }\r\n\r\n      if (\r\n        nodeDef.extensions &&\r\n        nodeDef.extensions[EXTENSIONS.KHR_LIGHTS_PUNCTUAL] &&\r\n        nodeDef.extensions[EXTENSIONS.KHR_LIGHTS_PUNCTUAL].light !== undefined\r\n      ) {\r\n        pending.push(\r\n          parser.getDependency('light', nodeDef.extensions[EXTENSIONS.KHR_LIGHTS_PUNCTUAL].light)\r\n        );\r\n      }\r\n\r\n      return Promise.all(pending);\r\n    })().then(function (objects) {\r\n      var node;\r\n\r\n      // .isBone isn't in glTF spec. See .markDefs\r\n      if (nodeDef.isBone === true) {\r\n        node = new Bone();\r\n      } else if (objects.length > 1) {\r\n        node = new Group();\r\n      } else if (objects.length === 1) {\r\n        node = objects[0];\r\n      } else {\r\n        node = new Object3D();\r\n      }\r\n\r\n      if (node !== objects[0]) {\r\n        for (var i = 0, il = objects.length; i < il; i++) {\r\n          node.add(objects[i]);\r\n        }\r\n      }\r\n\r\n      if (nodeDef.name) {\r\n        node.userData.name = nodeDef.name;\r\n        node.name = PropertyBinding.sanitizeNodeName(nodeDef.name);\r\n      }\r\n\r\n      assignExtrasToUserData(node, nodeDef);\r\n\r\n      if (nodeDef.extensions) addUnknownExtensionsToUserData(extensions, node, nodeDef);\r\n\r\n      if (nodeDef.matrix !== undefined) {\r\n        var matrix = new Matrix4();\r\n        matrix.fromArray(nodeDef.matrix);\r\n        node.applyMatrix4(matrix);\r\n      } else {\r\n        if (nodeDef.translation !== undefined) {\r\n          node.position.fromArray(nodeDef.translation);\r\n        }\r\n\r\n        if (nodeDef.rotation !== undefined) {\r\n          node.quaternion.fromArray(nodeDef.rotation);\r\n        }\r\n\r\n        if (nodeDef.scale !== undefined) {\r\n          node.scale.fromArray(nodeDef.scale);\r\n        }\r\n      }\r\n\r\n      return node;\r\n    });\r\n  };\r\n\r\n  /**\r\n   * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#scenes\r\n   * @param {number} sceneIndex\r\n   * @return {Promise<Group>}\r\n   */\r\n  GLTFParser.prototype.loadScene = (function () {\r\n    // scene node hierachy builder\r\n\r\n    function buildNodeHierachy(nodeId, parentObject, json, parser) {\r\n      var nodeDef = json.nodes[nodeId];\r\n\r\n      return parser\r\n        .getDependency('node', nodeId)\r\n        .then(function (node) {\r\n          if (nodeDef.skin === undefined) return node;\r\n\r\n          // build skeleton here as well\r\n\r\n          var skinEntry;\r\n\r\n          return parser\r\n            .getDependency('skin', nodeDef.skin)\r\n            .then(function (skin) {\r\n              skinEntry = skin;\r\n\r\n              var pendingJoints = [];\r\n\r\n              for (var i = 0, il = skinEntry.joints.length; i < il; i++) {\r\n                pendingJoints.push(parser.getDependency('node', skinEntry.joints[i]));\r\n              }\r\n\r\n              return Promise.all(pendingJoints);\r\n            })\r\n            .then(function (jointNodes) {\r\n              node.traverse(function (mesh) {\r\n                if (!mesh.isMesh) return;\r\n\r\n                var bones = [];\r\n                var boneInverses = [];\r\n\r\n                for (var j = 0, jl = jointNodes.length; j < jl; j++) {\r\n                  var jointNode = jointNodes[j];\r\n\r\n                  if (jointNode) {\r\n                    bones.push(jointNode);\r\n\r\n                    var mat = new Matrix4();\r\n\r\n                    if (skinEntry.inverseBindMatrices !== undefined) {\r\n                      mat.fromArray(skinEntry.inverseBindMatrices.array, j * 16);\r\n                    }\r\n\r\n                    boneInverses.push(mat);\r\n                  } else {\r\n                    console.warn(\r\n                      'THREE.GLTFLoader: Joint \"%s\" could not be found.',\r\n                      skinEntry.joints[j]\r\n                    );\r\n                  }\r\n                }\r\n\r\n                mesh.bind(new Skeleton(bones, boneInverses), mesh.matrixWorld);\r\n              });\r\n\r\n              return node;\r\n            });\r\n        })\r\n        .then(function (node) {\r\n          // build node hierachy\r\n\r\n          parentObject.add(node);\r\n\r\n          var pending = [];\r\n\r\n          if (nodeDef.children) {\r\n            var children = nodeDef.children;\r\n\r\n            for (var i = 0, il = children.length; i < il; i++) {\r\n              var child = children[i];\r\n              pending.push(buildNodeHierachy(child, node, json, parser));\r\n            }\r\n          }\r\n\r\n          return Promise.all(pending);\r\n        });\r\n    }\r\n\r\n    return function loadScene(sceneIndex) {\r\n      var json = this.json;\r\n      var extensions = this.extensions;\r\n      var sceneDef = this.json.scenes[sceneIndex];\r\n      var parser = this;\r\n\r\n      // Loader returns Group, not Scene.\r\n      // See: https://github.com/mrdoob/three.js/issues/18342#issuecomment-578981172\r\n      var scene = new Group();\r\n      if (sceneDef.name) scene.name = sceneDef.name;\r\n\r\n      assignExtrasToUserData(scene, sceneDef);\r\n\r\n      if (sceneDef.extensions) addUnknownExtensionsToUserData(extensions, scene, sceneDef);\r\n\r\n      var nodeIds = sceneDef.nodes || [];\r\n\r\n      var pending = [];\r\n\r\n      for (var i = 0, il = nodeIds.length; i < il; i++) {\r\n        pending.push(buildNodeHierachy(nodeIds[i], scene, json, parser));\r\n      }\r\n\r\n      return Promise.all(pending).then(function () {\r\n        return scene;\r\n      });\r\n    };\r\n  })();\r\n\r\n  return GLTFLoader;\r\n})();\r\n\r\nexport { GLTFLoader };\r\n","import * as THREE from 'three';\r\n\r\nexport {initScene, initCamera}\r\n\r\nlet scene;\r\n\r\nfunction initScene() {\r\n    scene = new THREE.Scene();\r\n    scene.background = null;\r\n\r\n    initLight();\r\n\r\n    return scene;\r\n}\r\n\r\nfunction initCamera(isSeller) {\r\n    const camera = new THREE.PerspectiveCamera( 45, window.innerWidth / window.innerHeight, 1, 500 );\r\n    if (isSeller) {\r\n        console.log('changing camera position!');\r\n        camera.position.x = 0;\r\n        camera.position.y = 0;\r\n        camera.position.z = -10;\r\n        camera.lookAt( 0, 0, 0 );\r\n    } else {\r\n        camera.position.x = 0;\r\n        camera.position.y = 0;\r\n        camera.position.z = 10;\r\n        camera.lookAt( 0, 0, 0 );\r\n    }\r\n    return camera;\r\n}\r\n\r\nfunction initLight() {\r\n    const directionalLight1 = new THREE.DirectionalLight( 0xffffff, 1 );\r\n    directionalLight1.position.set(2, 2, 0);\r\n    scene.add(directionalLight1);\r\n\r\n    const directionalLight2 = new THREE.DirectionalLight( 0xffffff, 1 );\r\n    directionalLight2.position.set(2, 2, -20);\r\n    scene.add(directionalLight2);\r\n\r\n    const directionalLight3 = new THREE.DirectionalLight( 0xffffff, 1 );\r\n    directionalLight3.position.set(2, 2, 20);\r\n    scene.add(directionalLight3);\r\n}\r\n","export default class PeerConnection {\r\n    constructor() {\r\n        this.peerConnectionConfig = {\r\n            'iceServers': [\r\n                {\r\n                  'urls': 'stun:stun.l.google.com:19302'\r\n                },\r\n                {\r\n                  'urls': 'turn:numb.viagenie.ca',\r\n                  'credential': 'muazkh',\r\n                  'username': 'webrtc@live.com'\r\n                },\r\n                {\r\n                  'urls': 'turn:192.158.29.39:3478?transport=udp',\r\n                  'credential': 'JZEOEt2V3Qb0y27GRntt2u2PAYA=',\r\n                  'username': '28224511:1379330808'\r\n                },\r\n                {\r\n                  'urls': 'turn:192.158.29.39:3478?transport=tcp',\r\n                  'credential': 'JZEOEt2V3Qb0y27GRntt2u2PAYA=',\r\n                  'username': '28224511:1379330808'\r\n                }\r\n            ]\r\n        };\r\n\r\n        this.rtcPeerConnection = this.create();\r\n        this.dataChannels = [];\r\n\r\n        return this.rtcPeerConnection;\r\n    }\r\n\r\n    create() {\r\n        try {\r\n            if (location.hostname !== 'localhost') {\r\n            this.rtcPeerConnection = new RTCPeerConnection(this.peerConnectionConfig);\r\n            } else {\r\n                this.rtcPeerConnection = new RTCPeerConnection(this.peerConnectionConfig);\r\n            }\r\n        \r\n            console.log('Created RTCPeerConnnection: ' + this.rtcPeerConnection);\r\n            return this.rtcPeerConnection;\r\n\r\n          } catch (e) {\r\n            console.log('Failed to create PeerConnection, exception: ' + e.message);\r\n            alert('Cannot create RTCPeerConnection object.');\r\n            return;\r\n        }\r\n    }\r\n\r\n    createDataChannel(channelName) {\r\n        if (this.rtcPeerConnection) {\r\n            let dataChannel = this.rtcPeerConnection.createDataChannel(channelName, {\r\n                ordered: false,\r\n                id: room\r\n            });\r\n\r\n            \r\n            this.dataChannels.push(dataChannel);\r\n        }\r\n    }\r\n}","export {GameController};\r\n\r\nimport {dataChannel} from '../../webrtc/videoCall';\r\n\r\nlet localObjects = []; // JSONs of locally maintained objects - we send updates for these\r\n// let localObjectsMap = new Map();\r\n\r\nconst GameController = () => {\r\n\r\n    function addLocalObject(obj) {\r\n\r\n        console.log(\"localObject added for game sync: \" + JSON.stringify(obj) + \" id: \" + obj.id)\r\n        let customObject = {uuid: obj.uuid, position: obj.position, rotation: obj.rotation};\r\n        let json = JSON.stringify(customObject);\r\n        localObjects.push(json);\r\n\r\n        // localObjectsMap.set(obj.id, json);\r\n\r\n    }\r\n\r\n    let sharedSceneSync; \r\n    function startSharedSceneSync() {\r\n        // sharedSceneSync = setInterval(sendLocalObjectsUpdate, 30);\r\n        // console.log(\"STARTED SHARED SCENE SYNC\")\r\n    }\r\n\r\n    function stopSharedSceneSync() {\r\n        clearInterval(sharedSceneSync);\r\n    }\r\n\r\n    function sendSharedSceneUpdates() {\r\n    //TODO send all localObjects in the shared scene to remote\r\n\r\n    //if there are objects from this client in the shared scene\r\n\r\n    //then send their pos/rot etc to remote\r\n    }\r\n\r\n    // sends a single object right now, used when dragging\r\n    function sendGameobjectUpdate(objectJson) {\r\n        if (dataChannel && typeof objectJson !== 'undefined' && dataChannel.readyState === \"open\") {\r\n            dataChannel.send(objectJson);\r\n        }\r\n    }\r\n\r\n    function sendLocalObjectsUpdate() {\r\n        // console.log(\"localObjects: \" + localObjects);\r\n        if (dataChannel !== 'undefined' && dataChannel.readyState === \"open\"){\r\n            localObjects.forEach(element => {\r\n                dataChannel.send(element);\r\n                console.log(\"Sent Update of local Object \" + element)\r\n            });\r\n        }\r\n    }\r\n\r\n    function updateRemoteObjects(data) {\r\n        let obj = JSON.parse(data);\r\n        // console.log('Parsed JSON uuid: ' + obj.uuid + ', positionx: ' + obj.position.x + ', rotationx: ' + obj.rotation._x);\r\n    \r\n        //TODO update only specific object!\r\n        localElement = getLocalObject\r\n        cube.position.x = obj.position.x;\r\n        cube.position.y = obj.position.y;\r\n        cube.position.z = obj.position.z;\r\n        cube.rotation.x = obj.rotation._x;\r\n        cube.rotation.y = obj.rotation._y;\r\n        cube.rotation.z = obj.rotation._z;\r\n    \r\n        //TOOD maybe tween/interpolate between positions\r\n    \r\n    }\r\n\r\n    return {\r\n        addLocalObject,\r\n        startSharedSceneSync,\r\n        stopSharedSceneSync,\r\n        sendGameobjectUpdate,\r\n        updateRemoteObjects\r\n    }\r\n\r\n}","import * as THREE from 'three';\r\nimport TWEEN from '@tweenjs/tween.js';\r\nimport {GLTFLoader} from 'three/examples/jsm/loaders/GLTFLoader';\r\nimport {DragControls} from 'three/examples/jsm/controls/DragControls'\r\nimport {OrbitControls} from 'three/examples/jsm/controls/OrbitControls';\r\nimport {GameController} from './game/gameController.js';\r\n\r\nimport {initScene, initCamera} from './game/scene';\r\n\r\nexport {startGame, getSceneJSON, updateRemoteObjects, moveRemoteVideoToScene};\r\n\r\nconst gameController = GameController();\r\n\r\n// an array of objects to sync\r\nconst objectsToSync = new Map();\r\n\r\nconst renderer = new THREE.WebGLRenderer({\r\n    alpha: true\r\n});\r\n\r\nlet localScene;\r\nlet localCamera;\r\n\r\nlet dragControl;\r\nlet draggableObjectsSeller = [];\r\n\r\nlet cube, cube2, cube3;\r\nlet isSeller = false;\r\n\r\nlet duckMesh;\r\n// let orbitControls;\r\n\r\nfunction startGame(isInitiator) {\r\n    isSeller = isInitiator;\r\n    console.log(\"Started game with isInitiator = \" + isInitiator);\r\n    init();\r\n    init3DObjects();\r\n    activateDragControls();\r\n    animate();\r\n}\r\n\r\nfunction init() {\r\n\r\n    renderer.setPixelRatio( window.devicePixelRatio );\r\n    renderer.setSize( window.innerWidth, window.innerHeight );\r\n    renderer.autoClear = false;\r\n    document.getElementById(\"appContainer\").appendChild( renderer.domElement );\r\n\r\n    localScene = initScene();\r\n    localCamera =  initCamera(isSeller);\r\n\r\n    // orbitControls = new OrbitControls( localCamera, renderer.domElement );\r\n\r\n}\r\n\r\nasync function init3DObjects() {\r\n    const loader = new GLTFLoader();\r\n    let loadedData = await loader.loadAsync('assets/models/duck.gltf');\r\n    loadedData.scene.traverse((o) => {\r\n        if (o.isMesh) {\r\n            // console.dir('Loaded data: ' + JSON.stringify(o));\r\n            duckMesh = new THREE.Mesh();\r\n            o.scale.set(0.01,0.01,0.01);\r\n\r\n            duckMesh = o;\r\n            let drago = new DragControls( [duckMesh], localCamera, renderer.domElement );\r\n            drago.addEventListener( 'drag', function(event) {\r\n                gameController.sendGameobjectUpdate(getObjJSON(event.object));\r\n                render();\r\n            } );\r\n\r\n        };\r\n    });\r\n\r\n    if (isSeller) { \r\n        // init seller specific items in local scene\r\n\r\n        let duckMesh1 = duckMesh.clone();\r\n        duckMesh1.name = \"duckMesh1\";\r\n        localScene.add(duckMesh1);\r\n        duckMesh1.position.set(0, -4, 0);\r\n        objectsToSync.set(duckMesh1.name, duckMesh1);\r\n        addObjectToDragConrols(duckMesh1);\r\n\r\n        let duckMesh2 = duckMesh.clone();\r\n        duckMesh2.name = \"duckMesh2\";\r\n        duckMesh2.position.set(1, -4, 0);\r\n        localScene.add(duckMesh2);\r\n        objectsToSync.set(duckMesh2.name, duckMesh2);\r\n        addObjectToDragConrols(duckMesh2);\r\n\r\n    } else {\r\n        // init buyer specific items in local scene\r\n\r\n        let duckMesh3 = duckMesh.clone();\r\n        duckMesh3.name = \"duckMesh3\";\r\n        duckMesh3.position.set(-1, -4, 0);\r\n        localScene.add(duckMesh3);\r\n        objectsToSync.set(duckMesh3.name, duckMesh3);\r\n        addObjectToDragConrols(duckMesh3);\r\n\r\n    }\r\n\r\n   \r\n    renderer.outputEncoding = THREE.sRGBEncoding;\r\n\r\n    \r\n\r\n    // init static stuff for both (eg. counter, etc)\r\n    // load3dAsset(loader, '../../assets/abricot.gltf', new THREE.Vector3(0.2, 0.2, 0.2), 'apricotTemplate', personalSpace);\r\n    // load3dAsset(loader, '../../assets/banana.glb', new THREE.Vector3(0.2, 0.2, 0.2), 'bananaTemplate', personalSpace);\r\n    const geometry = new THREE.PlaneGeometry( 4, 8/3 );\r\n    const material = new THREE.MeshBasicMaterial( {color: 0x8B4513, side: THREE.DoubleSide} );\r\n    const plane = new THREE.Mesh( geometry, material );\r\n    plane.position.y = -2;\r\n    plane.rotation.x = Math.PI / 2;\r\n    localScene.add( plane );\r\n\r\n}\r\n\r\nfunction moveRemoteVideoToScene() {\r\n    setTimeout(() => {\r\n        console.log(\"------------moveRemoteVideoToScene-------------\");\r\n        const remoteVideo = document.getElementById(\"remoteVideo\");\r\n        const reomoteVideoAspectRatio = remoteVideo.offsetWidth/remoteVideo.offsetHeight;\r\n        console.log(remoteVideo);\r\n        console.log(\"width: \" + remoteVideo.offsetWidth);\r\n        console.log(\"height: \" + remoteVideo.offsetHeight);\r\n\r\n        const videoGeometry = new THREE.PlaneGeometry( 4, 4/reomoteVideoAspectRatio );\r\n        const videoMaterial = makeVideoMaterial(\"remoteVideo\");\r\n        const cube2 = new THREE.Mesh( videoGeometry, videoMaterial );\r\n        localScene.add( cube2 );\r\n    }, 1000 );\r\n}\r\n\r\n\r\nfunction activateDragControls() {\r\n\r\n    \r\n    dragControl = new DragControls( [ ...draggableObjectsSeller ], localCamera, renderer.domElement );\r\n    //dragControl.transforGroup = true;\r\n    dragControl.addEventListener( 'drag', function(event) {\r\n        gameController.sendGameobjectUpdate(getObjJSON(event.object));\r\n        render();\r\n    } );\r\n   \r\n    // dragControl.addEventListener('dragend', function(event) {\r\n    //     if(event.object.position.y > -1.5) {\r\n\r\n    //         let temp = event.object.clone();\r\n    //         temp.position.set(event.object.position.x, event.object.position.y, event.object.position.z);\r\n    //         temp.name = temp.uuid;\r\n    //         personalSpace.add(temp);\r\n    //         objectsToSync.set(temp.name, temp);\r\n    //         addObjectToDragConrols(temp);\r\n    //     }\r\n    //     event.object.position.set(event.object.startPosition.x, event.object.startPosition.y, event.object.startPosition.z);\r\n    // });\r\n}\r\n\r\nfunction animate() {\r\n    requestAnimationFrame( animate );\r\n    //cube.rotation.y += 0.01;\r\n    // orbitControls.update();\r\n    renderer.render( localScene, localCamera );\r\n}\r\n\r\nfunction getObjJSON(object) {\r\n    let obj = {name: object.name, position: object.position, rotation: object.rotation};\r\n    let json = JSON.stringify(obj);\r\n    console.log('JSON:' + json)\r\n    return json;\r\n}\r\n\r\nfunction getSceneJSON() {\r\n    // TODO build and return a JSON from all localObjects, not only cube\r\n    let cubeObj = {uuid: cube.uuid, position: cube.position, rotation: cube.rotation};\r\n    // let json = JSON.stringify(cubeObj);\r\n    let json = JSON.stringify(draggableObjectsSeller);\r\n    // console.log('JSON:' + json)\r\n    return json;\r\n}\r\n\r\nfunction updateRemoteObjects(data) {\r\n    let obj = JSON.parse(data);\r\n    // console.log('Parsed JSON uuid: ' + obj.uuid + ', positionx: ' + obj.position.x + ', rotationx: ' + obj.rotation._x);\r\n\r\n    if(objectsToSync.has(obj.name)) {\r\n        let localElement = localScene.getObjectByName(obj.name);\r\n\r\n        localElement.position.x = obj.position.x;\r\n        localElement.position.y = obj.position.y;\r\n        localElement.position.z = obj.position.z;\r\n        localElement.rotation.x = obj.rotation._x;\r\n        localElement.rotation.y = obj.rotation._y;\r\n        localElement.rotation.z = obj.rotation._z;\r\n    } else {\r\n        // creates and add to scene and objectsToSync\r\n        duckMesh.name = obj.name;\r\n        duckMesh.position.set(obj.position.x, obj.position.y, obj.position.z);\r\n        let newObj = duckMesh.clone();\r\n        // let newObj = initCube(DEFAULT_VALUES.geometryCube, DEFAULT_VALUES.colorRed, new THREE.Vector3(obj.position.x, obj.position.y, obj.position.z), true, draggableObjectsSeller, personalSpace);\r\n        objectsToSync.set(newObj.name, newObj);\r\n        // newObj.position.set(obj.position.x, obj.position.y, obj.position.z);\r\n        localScene.add(newObj);\r\n        addObjectToDragConrols(newObj);\r\n    }\r\n    \r\n    //TOOD maybe tween/interpolate between positions\r\n}\r\n\r\nfunction addObjectToDragConrols(obj) {\r\n    draggableObjectsSeller.push(obj);\r\n    dragControl = new DragControls([...draggableObjectsSeller], localCamera, renderer.domElement).addEventListener('drag', function(event) {\r\n        gameController.sendGameobjectUpdate(getObjJSON(event.object));\r\n        render();\r\n    });\r\n}\r\n\r\nfunction makeVideoMaterial(id) {\r\n    let videoElement = document.getElementById(id);\r\n    let videoTexture = new THREE.VideoTexture(videoElement);\r\n  \r\n    let videoMaterial = new THREE.MeshBasicMaterial({\r\n      map: videoTexture,\r\n      overdraw: true,\r\n      side: THREE.DoubleSide,\r\n    });\r\n  \r\n    return videoMaterial;\r\n  }\r\n\r\nfunction render() {\r\n\r\n    renderer.render( localScene, localCamera );\r\n}\r\n\r\n","import PeerConnection from \"./peerConnection\";\r\nimport {updateRemoteObjects, moveRemoteVideoToScene} from '../app/game';\r\n\r\nexport let dataChannel;\r\nexport let isInitiator;\r\n\r\nexport default class VideoCall{\r\n    constructor() {\r\n        isInitiator = false;\r\n        let isChannelReady = false;\r\n        let isStarted = false;\r\n\r\n        let localStream;\r\n        let remoteStream;\r\n\r\n        let peerConnection;\r\n        // let dataChannel;\r\n\r\n        ///////////////////////////////////////\r\n        /////   socket.io room handling   /////\r\n        ///////////////////////////////////////\r\n\r\n        // let room = '123';\r\n        let roomName = prompt('Enter room name:');\r\n\r\n        const socket = io.connect();\r\n\r\n        if (roomName !== '') {\r\n            socket.emit('create or join', roomName);\r\n            console.log('Attempted to create or join room', roomName);\r\n        }\r\n\r\n        socket.on('created', function(room) {\r\n            console.log('Created room ' + room);\r\n            isInitiator = true;\r\n        });\r\n\r\n        socket.on('full', function(room) {\r\n            //TODO show user that room is full.\r\n            console.log('Room ' + room + ' is full');\r\n        });\r\n\r\n        socket.on('join', function (room){\r\n            console.log('Another peer made a request to join room ' + room);\r\n            console.log('This peer is the initiator of room ' + room + '!');\r\n            isChannelReady = true;\r\n        });\r\n\r\n        socket.on('joined', function(room) {\r\n            console.log('joined: ' + room);\r\n            isChannelReady = true;\r\n        });\r\n\r\n        socket.on('log', function(array) {\r\n            console.log.apply(console, array);\r\n        });\r\n\r\n        socket.on('message', function(message) {\r\n            console.log('Client received message:', message);\r\n            if (message === 'got user media') {\r\n                maybeStart();\r\n            } else if (message.type === 'offer') {\r\n                if (!isInitiator && !isStarted) {\r\n                    maybeStart();\r\n                }\r\n                peerConnection.setRemoteDescription(message)\r\n                    .then(function () {\r\n                        return doAnswer();\r\n                })\r\n            } else if (message.type === 'answer' && isStarted) {\r\n                peerConnection.setRemoteDescription(new RTCSessionDescription(message));\r\n            } else if (message.type === 'candidate' && isStarted) {\r\n                var candidate = new RTCIceCandidate({\r\n                    sdpMLineIndex: message.label,\r\n                    candidate: message.candidate\r\n                    }\r\n                );\r\n                peerConnection.addIceCandidate(candidate);\r\n            } else if (message === 'bye' && isStarted) {\r\n                handleRemoteHangup();\r\n            }\r\n        });\r\n\r\n        function sendSignalingMessage(message) {\r\n            console.log('Client sending message: ', message);\r\n            socket.emit('message', roomName, message); \r\n        }\r\n\r\n\r\n        /////////////////////////////////////////////\r\n        /////   init video capture and stream   /////\r\n        /////////////////////////////////////////////\r\n\r\n        const localVideo = document.querySelector('#localVideo');\r\n        const remoteVideo = document.querySelector('#remoteVideo');\r\n\r\n        navigator.mediaDevices.getUserMedia({\r\n            video: true,\r\n            audio: true\r\n        })\r\n        .then(initLocalStream)\r\n        .catch(function(e) {\r\n            alert('getUserMedia() error: ' + e.name);\r\n        });\r\n\r\n        function initLocalStream(stream) {\r\n            console.log('Adding local stream.');\r\n            localStream = stream;\r\n            localVideo.srcObject = stream;\r\n            sendSignalingMessage('got user media');\r\n            if (isInitiator) {\r\n                maybeStart();\r\n            }\r\n        }\r\n\r\n        const maybeStart = () => {\r\n            console.log('>>>>>>> maybeStart() ', isStarted, localStream, isChannelReady);\r\n            if (!isStarted && typeof localStream !== 'undefined' && isChannelReady) {\r\n                console.log('>>>>>> creating peer connection');\r\n                initPeerConnection();\r\n                \r\n                for (const track of localStream.getTracks()) {\r\n                    peerConnection.addTrack(track);\r\n                }\r\n\r\n                moveRemoteVideoToScene();\r\n\r\n                isStarted = true;\r\n                console.log('isInitiator', isInitiator);\r\n                if (isInitiator) {\r\n                    initDataChannel();\r\n                    console.log('Created RTCDataChannel');\r\n                    doCall();\r\n                }\r\n\r\n                // gameController.startSharedSceneSync();\r\n            }\r\n        }\r\n\r\n\r\n\r\n        window.onpagehide = function() {\r\n            hangup();\r\n        };\r\n\r\n        // handle tabs closing(almost all browsers) or pagehide(needed for iPad/iPhone)\r\n        var isOnIOS = navigator.userAgent.match(/Mac/) && navigator.maxTouchPoints && navigator.maxTouchPoints > 2; // must be iOS...\r\n        var eventName = isOnIOS ? \"pagehide\" : \"beforeunload\";\r\n\r\n        window.addEventListener(eventName, function (event) { \r\n            sendSignalingMessage('bye');\r\n        });\r\n\r\n        //////////////////////////////////////////////\r\n        /////   create and handle PeerConnection ///// \r\n        //////////////////////////////////////////////\r\n\r\n        const initPeerConnection = () => {\r\n            peerConnection = new PeerConnection();\r\n            peerConnection.onicecandidate = handleIceCandidate;\r\n            peerConnection.ontrack = handleTrackAdded;\r\n            peerConnection.ondatachannel = handleDataChannelAdded;\r\n        }\r\n\r\n        function handleIceCandidate(event) {\r\n            console.log('icecandidate event: ', event);\r\n            if (event.candidate) {\r\n                sendSignalingMessage({\r\n                    type: 'candidate',\r\n                    label: event.candidate.sdpMLineIndex,\r\n                    id: event.candidate.sdpMid,\r\n                    candidate: event.candidate.candidate\r\n                });\r\n            } else {\r\n                console.log('End of candidates.');\r\n            }\r\n        }\r\n\r\n        function handleTrackAdded(event) {\r\n            if (event.streams && event.streams[0]) {\r\n                console.log(\"event streams detected\")\r\n                remoteVideo.srcObject = event.streams[0];\r\n            } else {\r\n                if (!remoteStream) {\r\n                    console.log(\"Creating new MediaStream\")\r\n                    remoteStream = new MediaStream();\r\n                }\r\n                console.log(\"adding track to remote stream\")\r\n                remoteStream.addTrack(event.track);\r\n                remoteVideo.setAttribute('src', remoteStream);\r\n                remoteVideo.srcObject = remoteStream;\r\n            }\r\n            remoteVideo.autoplay = true;\r\n        }\r\n\r\n        function handleCreateOfferError(event) {\r\n            console.log('createOffer() error: ', event);\r\n        }\r\n\r\n        function doCall() {\r\n            console.log('Sending offer to peer');\r\n            peerConnection.createOffer(setLocalAndSendMessage, handleCreateOfferError);\r\n        }\r\n\r\n        function doAnswer() {\r\n            console.log('Sending answer to peer.');\r\n            peerConnection.createAnswer().then(\r\n                setLocalAndSendMessage,\r\n                onCreateSessionDescriptionError\r\n            );\r\n        }\r\n\r\n        function setLocalAndSendMessage(sessionDescription) {\r\n            peerConnection.setLocalDescription(sessionDescription);\r\n            console.log('setLocalAndSendMessage sending message', sessionDescription);\r\n            sendSignalingMessage(sessionDescription);\r\n        }\r\n\r\n        function onCreateSessionDescriptionError(error) {\r\n            console.log('Failed to create session description: ' + error.toString());\r\n        }\r\n\r\n        function hangup() {\r\n            console.log('Hanging up.');\r\n            stop();\r\n            sendSignalingMessage('bye');\r\n        }\r\n\r\n        function handleRemoteHangup() {\r\n            console.log('Session terminated.');\r\n            stop();\r\n            isInitiator = true; //when remote leaves, this client will be the new initiator\r\n        }\r\n\r\n        function stop() {\r\n            isStarted = false;\r\n            dataChannel.close();\r\n            peerConnection.close();\r\n            peerConnection = null;\r\n            remoteVideo.pause();\r\n            remoteVideo.removeAttribute('src'); // empty source\r\n            remoteVideo.removeAttribute('autoplay');\r\n            remoteStream = null;\r\n            remoteVideo.load();\r\n            //   gameController.stopSharedSceneSync();\r\n        }\r\n\r\n        /////////////////////////////////////////////\r\n        /////   create and handle datachannel   /////\r\n        /////////////////////////////////////////////\r\n\r\n        function initDataChannel() {\r\n            console.log('CREATING DATACHANNEL gameUpdates')\r\n            dataChannel = peerConnection.createDataChannel('gameUpdates');\r\n            dataChannel.onmessage = handleReceiveMessage;\r\n            dataChannel.onerror = handleDataChannelError;\r\n            dataChannel.onopen = handleDataChannelStatusChange;\r\n            dataChannel.onclose = handleDataChannelStatusChange;\r\n\r\n            console.log('CREATED DATACHANNEL gameUpdates')\r\n        }\r\n\r\n        function handleDataChannelAdded(event) {\r\n            console.log('Received Channel Callback');\r\n            dataChannel = event.channel;\r\n            dataChannel.onmessage = handleReceiveMessage;\r\n            dataChannel.onerror = function (error) {\r\n                console.log(\"Data Channel Error:\", error);\r\n            };\r\n            dataChannel.onopen = handleDataChannelStatusChange;\r\n            dataChannel.onclose = handleDataChannelStatusChange;\r\n            console.log('CREATED DATACHANNEL gameUpdates');\r\n        }\r\n\r\n        function handleReceiveMessage(event) {\r\n            updateRemoteObjects(event.data);\r\n        }\r\n\r\n        function handleDataChannelError(error) {\r\n            console.log(\"Data Channel Error:\", error);\r\n        };\r\n\r\n        function handleDataChannelStatusChange(event) {\r\n            if (dataChannel) {\r\n                var state = dataChannel.readyState;\r\n\r\n                if (state === \"open\") {\r\n                    console.log(\"DATA CHANNEL STATE: open\")\r\n                } else {\r\n                    console.log(\"DATA CHANNEL STATE: closed\")\r\n                }\r\n            }\r\n        }\r\n\r\n        ///////////////////////////////////////////////\r\n        /////   synchronization of gameobjects    /////\r\n        ///////////////////////////////////////////////\r\n\r\n        // function startGameSync() {\r\n        //   let interval = setInterval(sendGameobjectPositions, 30);\r\n        // }\r\n\r\n        // function sendGameobjectPositions(sceneJson) {\r\n        //   //TODO send JSON Strings of gameobject and positions\r\n        //   if (dataChannel && dataChannel.readyState === \"open\") {\r\n        //     dataChannel.send(sceneJson);\r\n        //   }\r\n        // }\r\n\r\n    }\r\n}","import \"core-js/stable\";\r\nimport \"regenerator-runtime/runtime\";\r\n\r\nimport Config from './data/config';\r\nimport Detector from './utils/detector';\r\nimport GameScene from './app/gameScene';\r\nimport VideoCall, {isInitiator} from './webrtc/videoCall';\r\nimport {startGame} from './app/game';\r\n\r\n// Styles\r\nimport './../css/app.scss';\r\n\r\nlet videoCall;\r\n// Check environment and set the Config helper\r\nif(__ENV__ === 'dev') {\r\n    console.log('----- RUNNING IN DEV ENVIRONMENT! -----');\r\n\r\n    Config.isDev = true;\r\n}\r\n\r\ninitVideoChat()\r\ninitGame();\r\n\r\n\r\nfunction initVideoChat() {\r\n    if(__ENV__ !== 'dev') {\r\n        videoCall = new VideoCall();\r\n        // TODO get isInitiator from VideoCall somehow...\r\n    }\r\n}\r\n\r\n\r\n\r\nfunction initGame() {\r\n    // Check for webGL capabilities\r\n    if(!Detector.webgl) {\r\n        Detector.addGetWebGLMessage();\r\n    } else {\r\n        const container = document.getElementById('appContainer');\r\n        // new GameScene(container);\r\n        startGame(isInitiator);\r\n    }\r\n}\r\n","module.exports = function (THREE) {\r\n  var MOUSE = THREE.MOUSE;\r\n  if (!MOUSE) MOUSE = { LEFT: 0, MIDDLE: 1, RIGHT: 2 };\r\n\r\n  /**\r\n   * @author qiao / https://github.com/qiao\r\n   * @author mrdoob / http://mrdoob.com\r\n   * @author alteredq / http://alteredqualia.com/\r\n   * @author WestLangley / http://github.com/WestLangley\r\n   * @author erich666 / http://erichaines.com\r\n   */\r\n  /*global THREE, console */\r\n\r\n  function OrbitConstraint(object) {\r\n    this.object = object;\r\n\r\n    // \"target\" sets the location of focus, where the object orbits around\r\n    // and where it pans with respect to.\r\n    this.target = new THREE.Vector3();\r\n\r\n    // Limits to how far you can dolly in and out ( PerspectiveCamera only )\r\n    this.minDistance = 0;\r\n    this.maxDistance = Infinity;\r\n\r\n    // Limits to how far you can zoom in and out ( OrthographicCamera only )\r\n    this.minZoom = 0;\r\n    this.maxZoom = Infinity;\r\n\r\n    // How far you can orbit vertically, upper and lower limits.\r\n    // Range is 0 to Math.PI radians.\r\n    this.minPolarAngle = 0; // radians\r\n    this.maxPolarAngle = Math.PI; // radians\r\n\r\n    // How far you can orbit horizontally, upper and lower limits.\r\n    // If set, must be a sub-interval of the interval [ - Math.PI, Math.PI ].\r\n    this.minAzimuthAngle = -Infinity; // radians\r\n    this.maxAzimuthAngle = Infinity; // radians\r\n\r\n    // Set to true to enable damping (inertia)\r\n    // If damping is enabled, you must call controls.update() in your animation loop\r\n    this.enableDamping = false;\r\n    this.dampingFactor = 0.25;\r\n\r\n    ////////////\r\n    // internals\r\n\r\n    var scope = this;\r\n\r\n    var EPS = 0.000001;\r\n\r\n    // Current position in spherical coordinate system.\r\n    var theta;\r\n    var phi;\r\n\r\n    // Pending changes\r\n    var phiDelta = 0;\r\n    var thetaDelta = 0;\r\n    var scale = 1;\r\n    var panOffset = new THREE.Vector3();\r\n    var zoomChanged = false;\r\n\r\n    // API\r\n\r\n    this.getPolarAngle = function () {\r\n      return phi;\r\n    };\r\n\r\n    this.getAzimuthalAngle = function () {\r\n      return theta;\r\n    };\r\n\r\n    this.rotateLeft = function (angle) {\r\n      thetaDelta -= angle;\r\n    };\r\n\r\n    this.rotateUp = function (angle) {\r\n      phiDelta -= angle;\r\n    };\r\n\r\n    // pass in distance in world space to move left\r\n    this.panLeft = (function () {\r\n      var v = new THREE.Vector3();\r\n\r\n      return function panLeft(distance) {\r\n        var te = this.object.matrix.elements;\r\n\r\n        // get X column of matrix\r\n        v.set(te[0], te[1], te[2]);\r\n        v.multiplyScalar(-distance);\r\n\r\n        panOffset.add(v);\r\n      };\r\n    })();\r\n\r\n    // pass in distance in world space to move up\r\n    this.panUp = (function () {\r\n      var v = new THREE.Vector3();\r\n\r\n      return function panUp(distance) {\r\n        var te = this.object.matrix.elements;\r\n\r\n        // get Y column of matrix\r\n        v.set(te[4], te[5], te[6]);\r\n        v.multiplyScalar(distance);\r\n\r\n        panOffset.add(v);\r\n      };\r\n    })();\r\n\r\n    // pass in x,y of change desired in pixel space,\r\n    // right and down are positive\r\n    this.pan = function (deltaX, deltaY, screenWidth, screenHeight) {\r\n      if (scope.object instanceof THREE.PerspectiveCamera) {\r\n        // perspective\r\n        var position = scope.object.position;\r\n        var offset = position.clone().sub(scope.target);\r\n        var targetDistance = offset.length();\r\n\r\n        // half of the fov is center to top of screen\r\n        targetDistance *= Math.tan(((scope.object.fov / 2) * Math.PI) / 180.0);\r\n\r\n        // we actually don't use screenWidth, since perspective camera is fixed to screen height\r\n        scope.panLeft((2 * deltaX * targetDistance) / screenHeight);\r\n        scope.panUp((2 * deltaY * targetDistance) / screenHeight);\r\n      } else if (scope.object instanceof THREE.OrthographicCamera) {\r\n        // orthographic\r\n        scope.panLeft((deltaX * (scope.object.right - scope.object.left)) / screenWidth);\r\n        scope.panUp((deltaY * (scope.object.top - scope.object.bottom)) / screenHeight);\r\n      } else {\r\n        // camera neither orthographic or perspective\r\n        console.warn(\r\n          'WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.'\r\n        );\r\n      }\r\n    };\r\n\r\n    this.dollyIn = function (dollyScale) {\r\n      if (scope.object instanceof THREE.PerspectiveCamera) {\r\n        scale /= dollyScale;\r\n      } else if (scope.object instanceof THREE.OrthographicCamera) {\r\n        scope.object.zoom = Math.max(\r\n          this.minZoom,\r\n          Math.min(this.maxZoom, this.object.zoom * dollyScale)\r\n        );\r\n        scope.object.updateProjectionMatrix();\r\n        zoomChanged = true;\r\n      } else {\r\n        console.warn(\r\n          'WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.'\r\n        );\r\n      }\r\n    };\r\n\r\n    this.dollyOut = function (dollyScale) {\r\n      if (scope.object instanceof THREE.PerspectiveCamera) {\r\n        scale *= dollyScale;\r\n      } else if (scope.object instanceof THREE.OrthographicCamera) {\r\n        scope.object.zoom = Math.max(\r\n          this.minZoom,\r\n          Math.min(this.maxZoom, this.object.zoom / dollyScale)\r\n        );\r\n        scope.object.updateProjectionMatrix();\r\n        zoomChanged = true;\r\n      } else {\r\n        console.warn(\r\n          'WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.'\r\n        );\r\n      }\r\n    };\r\n\r\n    this.update = (function () {\r\n      var offset = new THREE.Vector3();\r\n\r\n      // so camera.up is the orbit axis\r\n      var quat = new THREE.Quaternion().setFromUnitVectors(object.up, new THREE.Vector3(0, 1, 0));\r\n      var quatInverse = quat.clone().inverse();\r\n\r\n      var lastPosition = new THREE.Vector3();\r\n      var lastQuaternion = new THREE.Quaternion();\r\n\r\n      return function () {\r\n        var position = this.object.position;\r\n\r\n        offset.copy(position).sub(this.target);\r\n\r\n        // rotate offset to \"y-axis-is-up\" space\r\n        offset.applyQuaternion(quat);\r\n\r\n        // angle from z-axis around y-axis\r\n\r\n        theta = Math.atan2(offset.x, offset.z);\r\n\r\n        // angle from y-axis\r\n\r\n        phi = Math.atan2(Math.sqrt(offset.x * offset.x + offset.z * offset.z), offset.y);\r\n\r\n        theta += thetaDelta;\r\n        phi += phiDelta;\r\n\r\n        // restrict theta to be between desired limits\r\n        theta = Math.max(this.minAzimuthAngle, Math.min(this.maxAzimuthAngle, theta));\r\n\r\n        // restrict phi to be between desired limits\r\n        phi = Math.max(this.minPolarAngle, Math.min(this.maxPolarAngle, phi));\r\n\r\n        // restrict phi to be betwee EPS and PI-EPS\r\n        phi = Math.max(EPS, Math.min(Math.PI - EPS, phi));\r\n\r\n        var radius = offset.length() * scale;\r\n\r\n        // restrict radius to be between desired limits\r\n        radius = Math.max(this.minDistance, Math.min(this.maxDistance, radius));\r\n\r\n        // move target to panned location\r\n        this.target.add(panOffset);\r\n\r\n        offset.x = radius * Math.sin(phi) * Math.sin(theta);\r\n        offset.y = radius * Math.cos(phi);\r\n        offset.z = radius * Math.sin(phi) * Math.cos(theta);\r\n\r\n        // rotate offset back to \"camera-up-vector-is-up\" space\r\n        offset.applyQuaternion(quatInverse);\r\n\r\n        position.copy(this.target).add(offset);\r\n\r\n        this.object.lookAt(this.target);\r\n\r\n        if (this.enableDamping === true) {\r\n          thetaDelta *= 1 - this.dampingFactor;\r\n          phiDelta *= 1 - this.dampingFactor;\r\n        } else {\r\n          thetaDelta = 0;\r\n          phiDelta = 0;\r\n        }\r\n\r\n        scale = 1;\r\n        panOffset.set(0, 0, 0);\r\n\r\n        // update condition is:\r\n        // min(camera displacement, camera rotation in radians)^2 > EPS\r\n        // using small-angle approximation cos(x/2) = 1 - x^2 / 8\r\n\r\n        if (\r\n          zoomChanged ||\r\n          lastPosition.distanceToSquared(this.object.position) > EPS ||\r\n          8 * (1 - lastQuaternion.dot(this.object.quaternion)) > EPS\r\n        ) {\r\n          lastPosition.copy(this.object.position);\r\n          lastQuaternion.copy(this.object.quaternion);\r\n          zoomChanged = false;\r\n\r\n          return true;\r\n        }\r\n\r\n        return false;\r\n      };\r\n    })();\r\n  }\r\n\r\n  // This set of controls performs orbiting, dollying (zooming), and panning. It maintains\r\n  // the \"up\" direction as +Y, unlike the TrackballControls. Touch on tablet and phones is\r\n  // supported.\r\n  //\r\n  //    Orbit - left mouse / touch: one finger move\r\n  //    Zoom - middle mouse, or mousewheel / touch: two finger spread or squish\r\n  //    Pan - right mouse, or arrow keys / touch: three finter swipe\r\n\r\n  function OrbitControls(object, domElement) {\r\n    var constraint = new OrbitConstraint(object);\r\n\r\n    this.domElement = domElement !== undefined ? domElement : document;\r\n\r\n    // API\r\n\r\n    Object.defineProperty(this, 'constraint', {\r\n      get: function () {\r\n        return constraint;\r\n      },\r\n    });\r\n\r\n    this.getPolarAngle = function () {\r\n      return constraint.getPolarAngle();\r\n    };\r\n\r\n    this.getAzimuthalAngle = function () {\r\n      return constraint.getAzimuthalAngle();\r\n    };\r\n\r\n    // Set to false to disable this control\r\n    this.enabled = true;\r\n\r\n    // center is old, deprecated; use \"target\" instead\r\n    this.center = this.target;\r\n\r\n    // This option actually enables dollying in and out; left as \"zoom\" for\r\n    // backwards compatibility.\r\n    // Set to false to disable zooming\r\n    this.enableZoom = true;\r\n    this.zoomSpeed = 1.0;\r\n\r\n    // Set to false to disable rotating\r\n    this.enableRotate = true;\r\n    this.rotateSpeed = 1.0;\r\n\r\n    // Set to false to disable panning\r\n    this.enablePan = true;\r\n    this.keyPanSpeed = 7.0; // pixels moved per arrow key push\r\n\r\n    // Set to true to automatically rotate around the target\r\n    // If auto-rotate is enabled, you must call controls.update() in your animation loop\r\n    this.autoRotate = false;\r\n    this.autoRotateSpeed = 2.0; // 30 seconds per round when fps is 60\r\n\r\n    // Set to false to disable use of the keys\r\n    this.enableKeys = true;\r\n\r\n    // The four arrow keys\r\n    this.keys = { LEFT: 37, UP: 38, RIGHT: 39, BOTTOM: 40 };\r\n\r\n    // Mouse buttons\r\n    this.mouseButtons = {\r\n      ORBIT: THREE.MOUSE.LEFT,\r\n      ZOOM: THREE.MOUSE.MIDDLE,\r\n      PAN: THREE.MOUSE.RIGHT,\r\n    };\r\n\r\n    ////////////\r\n    // internals\r\n\r\n    var scope = this;\r\n\r\n    var rotateStart = new THREE.Vector2();\r\n    var rotateEnd = new THREE.Vector2();\r\n    var rotateDelta = new THREE.Vector2();\r\n\r\n    var panStart = new THREE.Vector2();\r\n    var panEnd = new THREE.Vector2();\r\n    var panDelta = new THREE.Vector2();\r\n\r\n    var dollyStart = new THREE.Vector2();\r\n    var dollyEnd = new THREE.Vector2();\r\n    var dollyDelta = new THREE.Vector2();\r\n\r\n    var STATE = {\r\n      NONE: -1,\r\n      ROTATE: 0,\r\n      DOLLY: 1,\r\n      PAN: 2,\r\n      TOUCH_ROTATE: 3,\r\n      TOUCH_DOLLY: 4,\r\n      TOUCH_PAN: 5,\r\n    };\r\n\r\n    var state = STATE.NONE;\r\n\r\n    // for reset\r\n\r\n    this.target0 = this.target.clone();\r\n    this.position0 = this.object.position.clone();\r\n    this.zoom0 = this.object.zoom;\r\n\r\n    // events\r\n\r\n    var changeEvent = { type: 'change' };\r\n    var startEvent = { type: 'start' };\r\n    var endEvent = { type: 'end' };\r\n\r\n    // pass in x,y of change desired in pixel space,\r\n    // right and down are positive\r\n    function pan(deltaX, deltaY) {\r\n      var element = scope.domElement === document ? scope.domElement.body : scope.domElement;\r\n\r\n      constraint.pan(deltaX, deltaY, element.clientWidth, element.clientHeight);\r\n    }\r\n\r\n    this.update = function () {\r\n      if (this.autoRotate && state === STATE.NONE) {\r\n        constraint.rotateLeft(getAutoRotationAngle());\r\n      }\r\n\r\n      if (constraint.update() === true) {\r\n        this.dispatchEvent(changeEvent);\r\n      }\r\n    };\r\n\r\n    this.reset = function () {\r\n      state = STATE.NONE;\r\n\r\n      this.target.copy(this.target0);\r\n      this.object.position.copy(this.position0);\r\n      this.object.zoom = this.zoom0;\r\n\r\n      this.object.updateProjectionMatrix();\r\n      this.dispatchEvent(changeEvent);\r\n\r\n      this.update();\r\n    };\r\n\r\n    function getAutoRotationAngle() {\r\n      return ((2 * Math.PI) / 60 / 60) * scope.autoRotateSpeed;\r\n    }\r\n\r\n    function getZoomScale() {\r\n      return Math.pow(0.95, scope.zoomSpeed);\r\n    }\r\n\r\n    function onMouseDown(event) {\r\n      if (scope.enabled === false) return;\r\n\r\n      event.preventDefault();\r\n\r\n      if (event.button === scope.mouseButtons.ORBIT) {\r\n        if (scope.enableRotate === false) return;\r\n\r\n        state = STATE.ROTATE;\r\n\r\n        rotateStart.set(event.clientX, event.clientY);\r\n      } else if (event.button === scope.mouseButtons.ZOOM) {\r\n        if (scope.enableZoom === false) return;\r\n\r\n        state = STATE.DOLLY;\r\n\r\n        dollyStart.set(event.clientX, event.clientY);\r\n      } else if (event.button === scope.mouseButtons.PAN) {\r\n        if (scope.enablePan === false) return;\r\n\r\n        state = STATE.PAN;\r\n\r\n        panStart.set(event.clientX, event.clientY);\r\n      }\r\n\r\n      if (state !== STATE.NONE) {\r\n        document.addEventListener('mousemove', onMouseMove, false);\r\n        document.addEventListener('mouseup', onMouseUp, false);\r\n        scope.dispatchEvent(startEvent);\r\n      }\r\n    }\r\n\r\n    function onMouseMove(event) {\r\n      if (scope.enabled === false) return;\r\n\r\n      event.preventDefault();\r\n\r\n      var element = scope.domElement === document ? scope.domElement.body : scope.domElement;\r\n\r\n      if (state === STATE.ROTATE) {\r\n        if (scope.enableRotate === false) return;\r\n\r\n        rotateEnd.set(event.clientX, event.clientY);\r\n        rotateDelta.subVectors(rotateEnd, rotateStart);\r\n\r\n        // rotating across whole screen goes 360 degrees around\r\n        constraint.rotateLeft(\r\n          ((2 * Math.PI * rotateDelta.x) / element.clientWidth) * scope.rotateSpeed\r\n        );\r\n\r\n        // rotating up and down along whole screen attempts to go 360, but limited to 180\r\n        constraint.rotateUp(\r\n          ((2 * Math.PI * rotateDelta.y) / element.clientHeight) * scope.rotateSpeed\r\n        );\r\n\r\n        rotateStart.copy(rotateEnd);\r\n      } else if (state === STATE.DOLLY) {\r\n        if (scope.enableZoom === false) return;\r\n\r\n        dollyEnd.set(event.clientX, event.clientY);\r\n        dollyDelta.subVectors(dollyEnd, dollyStart);\r\n\r\n        if (dollyDelta.y > 0) {\r\n          constraint.dollyIn(getZoomScale());\r\n        } else if (dollyDelta.y < 0) {\r\n          constraint.dollyOut(getZoomScale());\r\n        }\r\n\r\n        dollyStart.copy(dollyEnd);\r\n      } else if (state === STATE.PAN) {\r\n        if (scope.enablePan === false) return;\r\n\r\n        panEnd.set(event.clientX, event.clientY);\r\n        panDelta.subVectors(panEnd, panStart);\r\n\r\n        pan(panDelta.x, panDelta.y);\r\n\r\n        panStart.copy(panEnd);\r\n      }\r\n\r\n      if (state !== STATE.NONE) scope.update();\r\n    }\r\n\r\n    function onMouseUp(/* event */) {\r\n      if (scope.enabled === false) return;\r\n\r\n      document.removeEventListener('mousemove', onMouseMove, false);\r\n      document.removeEventListener('mouseup', onMouseUp, false);\r\n      scope.dispatchEvent(endEvent);\r\n      state = STATE.NONE;\r\n    }\r\n\r\n    function onMouseWheel(event) {\r\n      if (scope.enabled === false || scope.enableZoom === false || state !== STATE.NONE) return;\r\n\r\n      event.preventDefault();\r\n      event.stopPropagation();\r\n\r\n      var delta = 0;\r\n\r\n      if (event.wheelDelta !== undefined) {\r\n        // WebKit / Opera / Explorer 9\r\n\r\n        delta = event.wheelDelta;\r\n      } else if (event.detail !== undefined) {\r\n        // Firefox\r\n\r\n        delta = -event.detail;\r\n      }\r\n\r\n      if (delta > 0) {\r\n        constraint.dollyOut(getZoomScale());\r\n      } else if (delta < 0) {\r\n        constraint.dollyIn(getZoomScale());\r\n      }\r\n\r\n      scope.update();\r\n      scope.dispatchEvent(startEvent);\r\n      scope.dispatchEvent(endEvent);\r\n    }\r\n\r\n    function onKeyDown(event) {\r\n      if (scope.enabled === false || scope.enableKeys === false || scope.enablePan === false)\r\n        return;\r\n\r\n      switch (event.keyCode) {\r\n        case scope.keys.UP:\r\n          pan(0, scope.keyPanSpeed);\r\n          scope.update();\r\n          break;\r\n\r\n        case scope.keys.BOTTOM:\r\n          pan(0, -scope.keyPanSpeed);\r\n          scope.update();\r\n          break;\r\n\r\n        case scope.keys.LEFT:\r\n          pan(scope.keyPanSpeed, 0);\r\n          scope.update();\r\n          break;\r\n\r\n        case scope.keys.RIGHT:\r\n          pan(-scope.keyPanSpeed, 0);\r\n          scope.update();\r\n          break;\r\n      }\r\n    }\r\n\r\n    function touchstart(event) {\r\n      if (scope.enabled === false) return;\r\n\r\n      switch (event.touches.length) {\r\n        case 1: // one-fingered touch: rotate\r\n          if (scope.enableRotate === false) return;\r\n\r\n          state = STATE.TOUCH_ROTATE;\r\n\r\n          rotateStart.set(event.touches[0].pageX, event.touches[0].pageY);\r\n          break;\r\n\r\n        case 2: // two-fingered touch: dolly\r\n          if (scope.enableZoom === false) return;\r\n\r\n          state = STATE.TOUCH_DOLLY;\r\n\r\n          var dx = event.touches[0].pageX - event.touches[1].pageX;\r\n          var dy = event.touches[0].pageY - event.touches[1].pageY;\r\n          var distance = Math.sqrt(dx * dx + dy * dy);\r\n          dollyStart.set(0, distance);\r\n          break;\r\n\r\n        case 3: // three-fingered touch: pan\r\n          if (scope.enablePan === false) return;\r\n\r\n          state = STATE.TOUCH_PAN;\r\n\r\n          panStart.set(event.touches[0].pageX, event.touches[0].pageY);\r\n          break;\r\n\r\n        default:\r\n          state = STATE.NONE;\r\n      }\r\n\r\n      if (state !== STATE.NONE) scope.dispatchEvent(startEvent);\r\n    }\r\n\r\n    function touchmove(event) {\r\n      if (scope.enabled === false) return;\r\n\r\n      event.preventDefault();\r\n      event.stopPropagation();\r\n\r\n      var element = scope.domElement === document ? scope.domElement.body : scope.domElement;\r\n\r\n      switch (event.touches.length) {\r\n        case 1: // one-fingered touch: rotate\r\n          if (scope.enableRotate === false) return;\r\n          if (state !== STATE.TOUCH_ROTATE) return;\r\n\r\n          rotateEnd.set(event.touches[0].pageX, event.touches[0].pageY);\r\n          rotateDelta.subVectors(rotateEnd, rotateStart);\r\n\r\n          // rotating across whole screen goes 360 degrees around\r\n          constraint.rotateLeft(\r\n            ((2 * Math.PI * rotateDelta.x) / element.clientWidth) * scope.rotateSpeed\r\n          );\r\n          // rotating up and down along whole screen attempts to go 360, but limited to 180\r\n          constraint.rotateUp(\r\n            ((2 * Math.PI * rotateDelta.y) / element.clientHeight) * scope.rotateSpeed\r\n          );\r\n\r\n          rotateStart.copy(rotateEnd);\r\n\r\n          scope.update();\r\n          break;\r\n\r\n        case 2: // two-fingered touch: dolly\r\n          if (scope.enableZoom === false) return;\r\n          if (state !== STATE.TOUCH_DOLLY) return;\r\n\r\n          var dx = event.touches[0].pageX - event.touches[1].pageX;\r\n          var dy = event.touches[0].pageY - event.touches[1].pageY;\r\n          var distance = Math.sqrt(dx * dx + dy * dy);\r\n\r\n          dollyEnd.set(0, distance);\r\n          dollyDelta.subVectors(dollyEnd, dollyStart);\r\n\r\n          if (dollyDelta.y > 0) {\r\n            constraint.dollyOut(getZoomScale());\r\n          } else if (dollyDelta.y < 0) {\r\n            constraint.dollyIn(getZoomScale());\r\n          }\r\n\r\n          dollyStart.copy(dollyEnd);\r\n\r\n          scope.update();\r\n          break;\r\n\r\n        case 3: // three-fingered touch: pan\r\n          if (scope.enablePan === false) return;\r\n          if (state !== STATE.TOUCH_PAN) return;\r\n\r\n          panEnd.set(event.touches[0].pageX, event.touches[0].pageY);\r\n          panDelta.subVectors(panEnd, panStart);\r\n\r\n          pan(panDelta.x, panDelta.y);\r\n\r\n          panStart.copy(panEnd);\r\n\r\n          scope.update();\r\n          break;\r\n\r\n        default:\r\n          state = STATE.NONE;\r\n      }\r\n    }\r\n\r\n    function touchend(/* event */) {\r\n      if (scope.enabled === false) return;\r\n\r\n      scope.dispatchEvent(endEvent);\r\n      state = STATE.NONE;\r\n    }\r\n\r\n    function contextmenu(event) {\r\n      event.preventDefault();\r\n    }\r\n\r\n    this.dispose = function () {\r\n      this.domElement.removeEventListener('contextmenu', contextmenu, false);\r\n      this.domElement.removeEventListener('mousedown', onMouseDown, false);\r\n      this.domElement.removeEventListener('mousewheel', onMouseWheel, false);\r\n      this.domElement.removeEventListener('MozMousePixelScroll', onMouseWheel, false); // firefox\r\n\r\n      this.domElement.removeEventListener('touchstart', touchstart, false);\r\n      this.domElement.removeEventListener('touchend', touchend, false);\r\n      this.domElement.removeEventListener('touchmove', touchmove, false);\r\n\r\n      document.removeEventListener('mousemove', onMouseMove, false);\r\n      document.removeEventListener('mouseup', onMouseUp, false);\r\n\r\n      window.removeEventListener('keydown', onKeyDown, false);\r\n    };\r\n\r\n    this.domElement.addEventListener('contextmenu', contextmenu, false);\r\n\r\n    this.domElement.addEventListener('mousedown', onMouseDown, false);\r\n    this.domElement.addEventListener('mousewheel', onMouseWheel, false);\r\n    this.domElement.addEventListener('MozMousePixelScroll', onMouseWheel, false); // firefox\r\n\r\n    this.domElement.addEventListener('touchstart', touchstart, false);\r\n    this.domElement.addEventListener('touchend', touchend, false);\r\n    this.domElement.addEventListener('touchmove', touchmove, false);\r\n\r\n    window.addEventListener('keydown', onKeyDown, false);\r\n\r\n    // force an update at start\r\n    this.update();\r\n  }\r\n\r\n  OrbitControls.prototype = Object.create(THREE.EventDispatcher.prototype);\r\n  OrbitControls.prototype.constructor = OrbitControls;\r\n\r\n  Object.defineProperties(OrbitControls.prototype, {\r\n    object: {\r\n      get: function () {\r\n        return this.constraint.object;\r\n      },\r\n    },\r\n\r\n    target: {\r\n      get: function () {\r\n        return this.constraint.target;\r\n      },\r\n\r\n      set: function (value) {\r\n        console.warn('THREE.OrbitControls: target is now immutable. Use target.set() instead.');\r\n        this.constraint.target.copy(value);\r\n      },\r\n    },\r\n\r\n    minDistance: {\r\n      get: function () {\r\n        return this.constraint.minDistance;\r\n      },\r\n\r\n      set: function (value) {\r\n        this.constraint.minDistance = value;\r\n      },\r\n    },\r\n\r\n    maxDistance: {\r\n      get: function () {\r\n        return this.constraint.maxDistance;\r\n      },\r\n\r\n      set: function (value) {\r\n        this.constraint.maxDistance = value;\r\n      },\r\n    },\r\n\r\n    minZoom: {\r\n      get: function () {\r\n        return this.constraint.minZoom;\r\n      },\r\n\r\n      set: function (value) {\r\n        this.constraint.minZoom = value;\r\n      },\r\n    },\r\n\r\n    maxZoom: {\r\n      get: function () {\r\n        return this.constraint.maxZoom;\r\n      },\r\n\r\n      set: function (value) {\r\n        this.constraint.maxZoom = value;\r\n      },\r\n    },\r\n\r\n    minPolarAngle: {\r\n      get: function () {\r\n        return this.constraint.minPolarAngle;\r\n      },\r\n\r\n      set: function (value) {\r\n        this.constraint.minPolarAngle = value;\r\n      },\r\n    },\r\n\r\n    maxPolarAngle: {\r\n      get: function () {\r\n        return this.constraint.maxPolarAngle;\r\n      },\r\n\r\n      set: function (value) {\r\n        this.constraint.maxPolarAngle = value;\r\n      },\r\n    },\r\n\r\n    minAzimuthAngle: {\r\n      get: function () {\r\n        return this.constraint.minAzimuthAngle;\r\n      },\r\n\r\n      set: function (value) {\r\n        this.constraint.minAzimuthAngle = value;\r\n      },\r\n    },\r\n\r\n    maxAzimuthAngle: {\r\n      get: function () {\r\n        return this.constraint.maxAzimuthAngle;\r\n      },\r\n\r\n      set: function (value) {\r\n        this.constraint.maxAzimuthAngle = value;\r\n      },\r\n    },\r\n\r\n    enableDamping: {\r\n      get: function () {\r\n        return this.constraint.enableDamping;\r\n      },\r\n\r\n      set: function (value) {\r\n        this.constraint.enableDamping = value;\r\n      },\r\n    },\r\n\r\n    dampingFactor: {\r\n      get: function () {\r\n        return this.constraint.dampingFactor;\r\n      },\r\n\r\n      set: function (value) {\r\n        this.constraint.dampingFactor = value;\r\n      },\r\n    },\r\n\r\n    // backward compatibility\r\n\r\n    noZoom: {\r\n      get: function () {\r\n        console.warn('THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead.');\r\n        return !this.enableZoom;\r\n      },\r\n\r\n      set: function (value) {\r\n        console.warn('THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead.');\r\n        this.enableZoom = !value;\r\n      },\r\n    },\r\n\r\n    noRotate: {\r\n      get: function () {\r\n        console.warn(\r\n          'THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead.'\r\n        );\r\n        return !this.enableRotate;\r\n      },\r\n\r\n      set: function (value) {\r\n        console.warn(\r\n          'THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead.'\r\n        );\r\n        this.enableRotate = !value;\r\n      },\r\n    },\r\n\r\n    noPan: {\r\n      get: function () {\r\n        console.warn('THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead.');\r\n        return !this.enablePan;\r\n      },\r\n\r\n      set: function (value) {\r\n        console.warn('THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead.');\r\n        this.enablePan = !value;\r\n      },\r\n    },\r\n\r\n    noKeys: {\r\n      get: function () {\r\n        console.warn('THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead.');\r\n        return !this.enableKeys;\r\n      },\r\n\r\n      set: function (value) {\r\n        console.warn('THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead.');\r\n        this.enableKeys = !value;\r\n      },\r\n    },\r\n\r\n    staticMoving: {\r\n      get: function () {\r\n        console.warn(\r\n          'THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead.'\r\n        );\r\n        return !this.constraint.enableDamping;\r\n      },\r\n\r\n      set: function (value) {\r\n        console.warn(\r\n          'THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead.'\r\n        );\r\n        this.constraint.enableDamping = !value;\r\n      },\r\n    },\r\n\r\n    dynamicDampingFactor: {\r\n      get: function () {\r\n        console.warn(\r\n          'THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead.'\r\n        );\r\n        return this.constraint.dampingFactor;\r\n      },\r\n\r\n      set: function (value) {\r\n        console.warn(\r\n          'THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead.'\r\n        );\r\n        this.constraint.dampingFactor = value;\r\n      },\r\n    },\r\n  });\r\n\r\n  return OrbitControls;\r\n};\r\n"],"sourceRoot":""}